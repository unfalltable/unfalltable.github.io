<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>JianHong</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Note">
<meta property="og:type" content="website">
<meta property="og:title" content="JianHong">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="JianHong">
<meta property="og:description" content="Note">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="JianHong">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="JianHong" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">JianHong</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Note/后端/Java/模块/GraphQL" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E6%A8%A1%E5%9D%97/GraphQL/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.696Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%A8%A1%E5%9D%97/">模块</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E6%A8%A1%E5%9D%97/GraphQL/">GraphQL</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li>Restful存在的弊端<ul>
<li>想要部分数据，但是返回的有多余的数据，资源浪费</li>
<li>一次请求不能满足需求</li>
</ul>
</li>
<li>按需索取资源、一次查询多个数据、无需划分版本</li>
</ul>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ul>
<li><p>Int：有符号32位</p>
</li>
<li><p>Float</p>
</li>
<li><p>String</p>
</li>
<li><p>Boolean</p>
</li>
<li><p>ID：唯一标识符</p>
</li>
<li><p>自定义类型</p>
</li>
<li><p>枚举</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">enum</span> <span class="string">Episode</span> &#123;</span><br><span class="line">	<span class="string">A</span></span><br><span class="line">	<span class="string">B</span></span><br><span class="line">	<span class="string">C</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>接口</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">interface</span> <span class="string">Character</span>	&#123; <span class="comment">#定义接口</span></span><br><span class="line">	<span class="attr">id:</span> <span class="string">ID!</span> <span class="comment">#!表示非空</span></span><br><span class="line">	<span class="attr">name:</span> <span class="string">String</span></span><br><span class="line">	<span class="attr">age:</span> <span class="string">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">type</span> <span class="string">Human</span> <span class="string">implements</span> <span class="string">Character&#123;</span></span><br><span class="line">	<span class="attr">id:</span> <span class="string">ID!</span> <span class="comment">#!表示非空</span></span><br><span class="line">	<span class="attr">name:</span> <span class="string">String</span></span><br><span class="line">	<span class="attr">age:</span> <span class="string">Int</span></span><br><span class="line">	<span class="comment">#其他的属性</span></span><br><span class="line"><span class="string">&#125;</span> </span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E6%A8%A1%E5%9D%97/GraphQL/" data-id="clrj8pzxq00776wuw2qudb9k2" data-title="GraphQL" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%A8%A1%E5%9D%97/" rel="tag">模块</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Note/后端/Java/开发/集成" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E9%9B%86%E6%88%90/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.693Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E9%9B%86%E6%88%90/">集成</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="集成Validator"><a href="#集成Validator" class="headerlink" title="集成Validator"></a>集成Validator</h2><ol>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在Controller上添加@Validated</p>
</li>
<li><p>入参字段前加上Validator相关注解，如果是对象则加@Valid，在对象内部再使用Validator相关注解即可</p>
</li>
<li><p>还可以实现分组校验，即按场景校验</p>
<ul>
<li><p>需要创建一个对象，定义需要分组校验的场景</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidParam</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="comment">//参数校验分组：增加</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> add &#123;&#125;</span><br><span class="line">    <span class="comment">//参数校验分组：编辑</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> edit &#123;&#125;</span><br><span class="line">    <span class="comment">//参数校验分组：删除</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> delete &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用时在Validator相关注解中指定即可</p>
</li>
<li><p>所有的字段都需要添加场景，否则不起作用</p>
</li>
</ul>
</li>
<li><p>支持自定义注解，即自定义规则校验</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义注解</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">//指定校验器</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = MyValidator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnnotation &#123;</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;Invalid value&quot;</span>;</span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义校验器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;MyAnnotation, String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(MyAnnotation constraintAnnotation)</span> &#123;</span><br><span class="line">        <span class="comment">// 初始化逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String value, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// 校验逻辑</span></span><br><span class="line">        <span class="keyword">return</span> value != <span class="literal">null</span> &amp;&amp; value.startsWith(<span class="string">&quot;My&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="集成mybatisplus"><a href="#集成mybatisplus" class="headerlink" title="集成mybatisplus"></a>集成mybatisplus</h2><ol>
<li>引入依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mybatis-plus --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis-plus代码生成器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1.tmp<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatisPlus Freemarker 模版引擎 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- freemarker 作为 MyBatis-Plus 自动生成代码时作为模板使用，还可选用 velocity 作为模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置信息</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mybatis配置</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment"># xml文件路径</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="comment"># 实体类路径</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.xjh.entity</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 驼峰转换</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 是否开启缓存</span></span><br><span class="line">    <span class="attr">cache-enabled:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># 打印sql</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="comment"># 全局配置</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="comment"># 数据库字段驼峰下划线转换</span></span><br><span class="line">    <span class="attr">db-column-underline:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># id自增类型(数据库id自增)</span></span><br><span class="line">    <span class="attr">id-type:</span> <span class="number">0</span></span><br><span class="line">    	<span class="comment"># 0 为数据库自增id</span></span><br><span class="line">    	<span class="comment"># 1 为不设置自增id</span></span><br><span class="line">    	<span class="comment"># 2 为用户输入id</span></span><br><span class="line">    	<span class="comment"># 3 为当插入对象为空时自动填充id</span></span><br><span class="line">    	<span class="comment"># 4 为分配字符串型的UUID</span></span><br></pre></td></tr></table></figure>

<ul>
<li>MyBatis-Plus 默认的id生成算法是 雪花算法 ，缺点是比较长</li>
</ul>
<ol start="3">
<li>配置启动类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;&quot;)</span></span><br><span class="line"><span class="meta">@ComponentScan(basepackages = &#123;&quot;&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> 启动类()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">genCode</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">    <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、全局配置</span></span><br><span class="line">    <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">    gc.setOutputDir(projectPath + <span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">    gc.setAuthor(<span class="string">&quot;jianhong.xu&quot;</span>);</span><br><span class="line">    gc.setOpen(<span class="literal">false</span>); <span class="comment">//生成后是否打开资源管理器</span></span><br><span class="line">    gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);	<span class="comment">//去掉Service接口的首字母I</span></span><br><span class="line">    gc.setIdType(IdType.AUTO); <span class="comment">//主键策略</span></span><br><span class="line">    gc.setSwagger2(<span class="literal">true</span>);<span class="comment">//开启Swagger2模式</span></span><br><span class="line">    mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3、数据源配置</span></span><br><span class="line">    <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">    dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/loan?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&quot;</span>);</span><br><span class="line">    dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">    dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    dsc.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    dsc.setDbType(DbType.MYSQL);</span><br><span class="line">    mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4、包配置</span></span><br><span class="line">    <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">    pc.setParent(<span class="string">&quot;xu.srb.core&quot;</span>);</span><br><span class="line">    pc.setEntity(<span class="string">&quot;pojo.entity&quot;</span>); <span class="comment">//此对象与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。</span></span><br><span class="line">    mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5、策略配置</span></span><br><span class="line">    <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">    strategy.setNaming(NamingStrategy.underline_to_camel);<span class="comment">//数据库表映射到实体的命名策略</span></span><br><span class="line">    strategy.setColumnNaming(NamingStrategy.underline_to_camel);<span class="comment">//数据库表字段映射到实体的命名策略</span></span><br><span class="line">    strategy.setEntityLombokModel(<span class="literal">true</span>); <span class="comment">// lombok</span></span><br><span class="line">    strategy.setLogicDeleteFieldName(<span class="string">&quot;is_deleted&quot;</span>);<span class="comment">//逻辑删除字段名</span></span><br><span class="line">    strategy.setEntityBooleanColumnRemoveIsPrefix(<span class="literal">true</span>);<span class="comment">//去掉布尔值的is_前缀（确保tinyint(1)）</span></span><br><span class="line">    strategy.setRestControllerStyle(<span class="literal">true</span>); <span class="comment">//restful api风格控制器 返回json</span></span><br><span class="line">    mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6、执行</span></span><br><span class="line">    mpg.execute();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分页插件"><a href="#分页插件" class="headerlink" title="分页插件"></a>分页插件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 3.4 之后</span></span><br><span class="line">    <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">    <span class="comment">// 指定数据源</span></span><br><span class="line">    <span class="type">PaginationInnerInterceptor</span> <span class="variable">paginationInnerInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL);</span><br><span class="line">    <span class="comment">// 设置分页最大数限时 -1 不限制</span></span><br><span class="line">    paginationInnerInterceptor.setMaxLimit(<span class="number">500L</span>);</span><br><span class="line">    interceptor.addInnerInterceptor(paginationInnerInterceptor);</span><br><span class="line">    <span class="comment">// 添加防止全表更新与删除插件 （防止恶意语句执行 如 update set 没有where）</span></span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">BlockAttackInnerInterceptor</span>());</span><br><span class="line">    <span class="keyword">return</span> interceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="填充器"><a href="#填充器" class="headerlink" title="填充器"></a>填充器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MetaObjectHandler <span class="title function_">getMybatisObjectHandler</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MetaObjectHandler</span>() &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CREATE_BY</span> <span class="operator">=</span> <span class="string">&quot;createBy&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UPDATE_BY</span> <span class="operator">=</span> <span class="string">&quot;updateBy&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CREATE_TIME</span> <span class="operator">=</span> <span class="string">&quot;createTime&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UPDATE_TIME</span> <span class="operator">=</span> <span class="string">&quot;updateTime&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">            fill(metaObject, CREATE_BY, CREATE_TIME);</span><br><span class="line">            fill(metaObject, UPDATE_BY, UPDATE_TIME);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">            fill(metaObject, UPDATE_BY, UPDATE_TIME);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fill</span><span class="params">(MetaObject metaObject, <span class="keyword">final</span> String userFiled, <span class="keyword">final</span> String time)</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> metaObject.getValue(userFiled);</span><br><span class="line">                <span class="keyword">if</span>(ObjectUtil.isNull(user)) &#123;</span><br><span class="line">                    setFieldValByName(userFiled, <span class="built_in">this</span>.getUserId(), metaObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ignored)&#123;&#125;</span><br><span class="line">            setFieldValByName(time, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 获取当前操作的用户 account */</span></span><br><span class="line">        <span class="keyword">private</span> Serializable <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">AccountUser</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(AccountUser.class);</span><br><span class="line">                <span class="keyword">return</span> user.getAccount();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Class&lt;?&gt; cls = Class.forName(<span class="string">&quot;com.bda.huijun.common.security.util.SecurityUtils&quot;</span>);</span><br><span class="line">                    <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectUtil.getMethod(cls, <span class="string">&quot;getAccount&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> (Serializable) method.invoke(<span class="literal">null</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line">                log.warn(<span class="string">&quot;accountUser not exist!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Nacos集成"><a href="#Nacos集成" class="headerlink" title="Nacos集成"></a>Nacos集成</h2><h3 id="注册中心"><a href="#注册中心" class="headerlink" title="注册中心"></a>注册中心</h3><ol>
<li>添加依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacos 服务发现 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>需要移除ribbon依赖</li>
</ul>
<ol start="2">
<li>添加服务注册发现注解 @EnableDiscoveryClient, 高版本可以不用加</li>
<li>配置</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">@artifactId@</span> <span class="comment">#服务名</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span> <span class="comment">#服务发现</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span> <span class="comment">#nacos地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">$&#123;spring.cloud.nacos.discovery.server-addr&#125;</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span></span><br><span class="line">        <span class="attr">import-check:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># SpringCloud 2021版本之后，需要用以下方式导入nacos的配置文件</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">import:</span> <span class="string">nacos:$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.yml</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>修改nacos配置文件 application.properties</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>创建nacos数据库，导入需要的表和数据</li>
<li>打开网站<ul>
<li><a target="_blank" rel="noopener" href="http://127.0.0.1:8848/nacos/index.html">http://127.0.0.1:8848/nacos/index.html</a></li>
<li>账号密码：nacos &#x2F; nacos</li>
</ul>
</li>
</ol>
<h3 id="配置中心"><a href="#配置中心" class="headerlink" title="配置中心"></a>配置中心</h3><ol>
<li>添加依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacos 服务配置中心 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置中心不生效的话添加boot--&gt;</span> <span class="comment">&lt;!--高版本需要--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建bootstrap.properties文件，配置服务名和配置中心地址</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">market-member</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span> <span class="comment">#配置中心地址</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">e63b0d76-dc0d-4521-a81c-2168c578e773</span> <span class="comment">#命名空间</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">dev</span> <span class="comment">#配置分组</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span></span><br><span class="line">        <span class="attr">ext-config:</span> <span class="comment">#加载多配置，配置上云管理</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">data-id:</span> <span class="string">datasource.yml</span></span><br><span class="line">            <span class="attr">group:</span> <span class="string">dev</span></span><br><span class="line">            <span class="attr">refresh:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>到nacos配置中心添加<ul>
<li>Data ID：模块名.yml</li>
<li>配置格式：yml</li>
</ul>
</li>
<li>设置动态获取配置<ul>
<li>@RefreshScope：在需要获取nacos配置的接口上添加，不需要重启服务就可以获取到</li>
<li>@Value：取值</li>
</ul>
</li>
</ol>
<h2 id="OpenFeign集成"><a href="#OpenFeign集成" class="headerlink" title="OpenFeign集成"></a>OpenFeign集成</h2><ol>
<li>添加依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建远程调用接口，添加@FeignClient注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(contextId = &quot;远程调用的接口&quot;,</span></span><br><span class="line"><span class="meta">        value = &quot;接口路径&quot;,</span></span><br><span class="line"><span class="meta">        fallback = HjImServiceFallBack.class,</span></span><br><span class="line"><span class="meta">        configuration = SentinelFeignConfig.class</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FeignService</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在需要远程调用的模块的启动类上添加@EnableFeignClients</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.xz.market.common.openfeign.feign&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XXXApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(XXXApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>注意</p>
<ul>
<li><p>如果使用了高版本的cloud的话需要修改依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--feign模块的pom中添加--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nacos模块的pom中修改--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>老版本cloud使用的是ribbon，新版本使用的是loadbalancer</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Gateway集成"><a href="#Gateway集成" class="headerlink" title="Gateway集成"></a>Gateway集成</h2><ol>
<li>依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>需要排除web依赖</li>
<li>需要引入nacos依赖</li>
</ul>
<ol start="2">
<li>配置</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">cloud:</span> </span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="comment">#路由转发断言、过滤、路径转换等等</span></span><br><span class="line">      <span class="attr">routes:</span>      </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/admin/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/admin/(?&lt;segment&gt;.*),</span> <span class="string">/renren-fast/$\(segment)</span></span><br><span class="line">      <span class="comment">#全局跨域配置</span></span><br><span class="line">      <span class="attr">globalcors:</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">cors-configurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOriginPatterns:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> </span><br></pre></td></tr></table></figure>

<h2 id="Camunda集成"><a href="#Camunda集成" class="headerlink" title="Camunda集成"></a>Camunda集成</h2><ol>
<li>依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--还需要springboot--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.camunda.bpm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>camunda-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.18.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Camunda控制台--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.camunda.bpm.springboot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>camunda-bpm-spring-boot-starter-webapp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Camunda Api--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.camunda.bpm.springboot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>camunda-bpm-spring-boot-starter-rest<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Camunda 数据结构--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.camunda.bpm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>camunda-engine-plugin-spin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.camunda.spin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>camunda-spin-dataformat-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--web--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--myba--&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>下载设计器（github下载），绘制对应的流程</li>
<li>创建camunda数据库，表会自动创建</li>
</ol>
<h2 id="EasyExcel集成"><a href="#EasyExcel集成" class="headerlink" title="EasyExcel集成"></a>EasyExcel集成</h2><ol>
<li>依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.pig4cloud.excel<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>excel-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 移除自带的log日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="Netty集成"><a href="#Netty集成" class="headerlink" title="Netty集成"></a>Netty集成</h2><ol>
<li>依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifacId</span>&gt;</span>netty-all<span class="tag">&lt;/<span class="name">artifacId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.39.Fin<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="GraphQl集成"><a href="#GraphQl集成" class="headerlink" title="GraphQl集成"></a>GraphQl集成</h2><ol>
<li><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.graphql-java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>graphql-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>需要添加第三方库才能下载，Maven配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>bintray-andimarek-graphql-java<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>bintray<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://dl.bintray.com/andimarek/graphql-java<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>在resources下创建.graphqls</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">schema</span> &#123; <span class="comment">#定义查询</span></span><br><span class="line">	<span class="attr">query:</span> <span class="string">查询的类型</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">type</span> <span class="string">查询的类型</span> &#123; <span class="comment">#定义查询的类型</span></span><br><span class="line">	<span class="string">对象(id:Long):</span> <span class="string">对象</span> <span class="comment">#制定对象以及参数类型</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">type</span> <span class="string">对象</span> &#123; <span class="comment">#定义对象</span></span><br><span class="line">	<span class="string">属性名:</span> <span class="string">属性类型!</span> <span class="comment">#!表示非空</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建GraphQLProvider，用于初始化GraphQL</p>
<ul>
<li><p>初始化GraphQL对象</p>
</li>
<li><p>读取.graphql文件，使用GraphQLSchema解析</p>
</li>
<li><p>指定查询的数据，创建一个MyDataFetcher接口，动态的传入查询的名称和数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphQLProvide</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> GraphQL graphQL;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//MyDataFetcher实现类的集合</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;MyDataFetcher&gt; myDataFetchers;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//初始化GraphQL对象</span></span><br><span class="line">    <span class="meta">@PostConstruct</span><span class="comment">//在Spring初始化时执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException&#123;</span><br><span class="line">        <span class="comment">//读取外部GraphQL文件并解析</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> ResourceUtils.getFile(<span class="string">&quot;classpath:haoke.graphqls&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.graphQL = GraphQL.newGraphQL(buildGraphQLSchema(file)).build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构建GraphQLSchema</span></span><br><span class="line">    <span class="keyword">private</span> GraphQLSchema <span class="title function_">buildGraphQLSchema</span><span class="params">(File file)</span>&#123;</span><br><span class="line">        <span class="type">TypeDefinitionRegistry</span> <span class="variable">typeRegistry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchemaParser</span>().parse(file);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SchemaGenerator</span>().makeExecutableSchema(typeRegistry, buildWiring());</span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//构建RuntimeWiring 优化</span></span><br><span class="line">    <span class="keyword">private</span> RuntimeWiring <span class="title function_">buildWiring</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> RuntimeWiring.newRuntimeWiring().type(<span class="string">&quot;HaokeQuery&quot;</span>, builder -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span>(MyDataFetcher myDataFetcher : myDataFetchers)&#123;</span><br><span class="line">                builder.dataFetcher(myDataFetcher.fieldName(), </span><br><span class="line">                                    enviroment -&gt; myDataFetcher.dataFetcher(enviroment));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> builder;</span><br><span class="line">        &#125;).build();</span><br><span class="line">    &#125;</span><br><span class="line">                                                     </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GraphQL <span class="title function_">graphQL</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.graphQL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>创建MyDataFetcher接口，其实现类实现获取查询名和数据的功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyDataFetcher</span>&#123;</span><br><span class="line">    <span class="comment">//GraphQL查询的名称</span></span><br><span class="line">    String <span class="title function_">fieldName</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//查询数据，enviroment中有参数</span></span><br><span class="line">    Object <span class="title function_">dataFetcher</span><span class="params">(DataFetchingEnviroment enviroment)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在GraphQLController中添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;graphql&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphQLController</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GraphQL graphQL;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">query</span><span class="params">(<span class="meta">@RequestParam(&quot;query&quot;)</span> String query)</span>&#123;					</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.graphQL.execute(query).toSpecification();<span class="comment">//标准输出，返回的时Map类型</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XXXDataFetcher</span> <span class="keyword">implements</span> <span class="title class_">MyDataFetcher</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> XXXService xxxService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//GrapgQl查询名</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fieldName</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;xxx&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通过参数查询数据</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">dataFetcher</span><span class="params">(DataFetchingEnviroment enviroment)</span>&#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">xxx</span> <span class="operator">=</span> enviroment.getArgument(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.xxxService.query(xxx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="OSS集成"><a href="#OSS集成" class="headerlink" title="OSS集成"></a>OSS集成</h2><h3 id="阿里云"><a href="#阿里云" class="headerlink" title="阿里云"></a>阿里云</h3><ol>
<li><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.aliyun.oss/aliyun-sdk-oss --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果使用spring-cloud-alicloud-oss 的话会和nacos注册中心依赖有冲突，所以使用aliyun-sdk-oss好一些</li>
</ul>
</li>
<li><p>配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">aliyun:</span></span><br><span class="line">    <span class="attr">endpoingt:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">accessKeyId:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">accessKeySecret:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">bucketName:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将 OSSClient 加入容器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;aliyun&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliyunConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OSSClient <span class="title function_">ossClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OSSClient</span>(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="MinIo"><a href="#MinIo" class="headerlink" title="MinIo"></a>MinIo</h3><ol>
<li><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--方式一--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这种方式无需配置minio client，可直接使用OssProperties、OssTemplate--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.pig4cloud.plugin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>oss-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--方式二--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">minio:</span></span><br><span class="line">	<span class="attr">endpoint:</span> </span><br><span class="line">	<span class="attr">accessKey:</span></span><br><span class="line">	<span class="attr">secretKey:</span></span><br><span class="line">	<span class="attr">bucket:</span></span><br><span class="line">		<span class="attr">files:</span> <span class="string">文件桶</span></span><br><span class="line">		<span class="attr">videofiles:</span> <span class="string">视频桶</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置MinioClient</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinioConfig</span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.endpoint&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.accessKey&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.secretKey&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MinioClient <span class="title function_">minioClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MinioClient</span> <span class="variable">minioClient</span> <span class="operator">=</span> MinioClient.builder()</span><br><span class="line">            .endpoint(endpoint)</span><br><span class="line">            .creadentials(accessKey, secretKey)</span><br><span class="line">            .build();</span><br><span class="line">        <span class="keyword">return</span> minioClient;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E9%9B%86%E6%88%90/" data-id="clrj8pzxw008l6wuwg165hisl" data-title="集成" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9B%86%E6%88%90/" rel="tag">集成</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Note/后端/Java/开发/集群" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E9%9B%86%E7%BE%A4/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.693Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E9%9B%86%E7%BE%A4/">集群</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><ul>
<li>Master主库在事务提交时，会把数据变更记录在Binlog中</li>
<li>从库读取主库的Binlog，写入到从库的中继日志Relay Log</li>
<li>从库重做RelayLog中的事件，将改变反映它自己的数据</li>
</ul>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ul>
<li><p>主库配置</p>
<ul>
<li><p>修改<code>/etc/my.cnf</code> </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysql服务ID，保证整个集群环境中为唯一，取值范围：1 - 2^32 - 1,默认唯一</span></span><br><span class="line"><span class="string">server-id=1</span></span><br><span class="line"><span class="comment">#是否只读，1代表只读，0代表读写</span></span><br><span class="line"><span class="string">read-only=0</span></span><br><span class="line"><span class="comment">#忽略的数据，指不需要同步的数据库</span></span><br><span class="line"><span class="comment">#binglog-ignore-db=mysql</span></span><br><span class="line"><span class="comment">#指定同步的数据库</span></span><br><span class="line"><span class="comment">#binlog-do-db=db01</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启mysql</p>
<ul>
<li><code>systemctl restart mysqld</code></li>
</ul>
</li>
<li><p>登录mysql，创建远程连接的账号，并授予主从复制权限</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建itcast用户，并设置密码，该用户可在任意主机连接该MySQL</span></span><br><span class="line"><span class="string">CREATE</span> <span class="string">USER</span> <span class="string">&#x27;itcast&#x27;</span><span class="string">@&#x27;%&#x27;</span> <span class="string">IDENTIFIED</span> <span class="string">WITH</span> <span class="string">mysql_native_password</span> <span class="string">BY</span> <span class="string">&#x27;Root@123456&#x27;</span><span class="string">;</span></span><br><span class="line"><span class="comment">#为&#x27;itcast@%&#x27;用户分配主从复制权限&#x27;</span></span><br><span class="line"><span class="string">GRANT</span> <span class="string">REPLICATION</span> <span class="string">SLAVE</span> <span class="string">ON</span> <span class="string">*.*</span> <span class="string">TO</span> <span class="string">&#x27;itcast&#x27;</span><span class="string">@&#x27;%&#x27;;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>从库配置</p>
<ul>
<li><p>修改配置文件&#x2F;etc&#x2F;my.cnf</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务ID，保证整个集群环境中唯一</span></span><br><span class="line"><span class="string">server-id=2</span></span><br><span class="line"><span class="comment">#是否只读，1代表只读</span></span><br><span class="line"><span class="string">read-only=1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启mysql</p>
<ul>
<li><code>systemctl restart mysqld</code></li>
</ul>
</li>
<li><p>登录mysql，设置主库配置</p>
</li>
<li><p>开启同步</p>
</li>
<li><p>查看主从状态</p>
</li>
</ul>
</li>
</ul>
<h1 id="Es集群"><a href="#Es集群" class="headerlink" title="Es集群"></a>Es集群</h1><ol>
<li>创建es-cluster文件夹，在下面创建节点目录</li>
<li>需要将es下的<code>elasticsearch.yml</code>和<code>jvm.options</code>拷贝到节点目录下</li>
<li>编辑<code>elasticsearch.yml</code>，添加节点名字<ul>
<li><code>cluster.name: 集群名字</code></li>
<li><code>node.name: 节点名字</code></li>
<li><code>http.port: 端口号</code></li>
<li><code>discovery.zen.ping.unicast.hosts: [&quot;广播地址&quot;]</code></li>
<li><code>discovery.zen.minimum_master_nodes: 最小master节点数</code></li>
<li><code>node.master: 是否为master节点</code></li>
<li><code>node.data: 是否为data节点</code></li>
</ul>
</li>
<li>编辑<code>jvm.options</code> ，修改jvm最大和最小堆内存</li>
<li>docker创建容器进行配置文件挂载</li>
</ol>
<h1 id="Redis集群"><a href="#Redis集群" class="headerlink" title="Redis集群"></a>Redis集群</h1><ol>
<li><p>使用Docker搭建redis集群，使用host网络类型，配置</p>
<ul>
<li>拉取镜像-创建容器-启动容器指定host网络类型</li>
</ul>
</li>
<li><p>创建<code>ClusterConfigurationProperties</code> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;spring.redis.cluster&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClusterConfigurationProperties</span>&#123;</span><br><span class="line">    <span class="comment">//存放所有节点的ip地址</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; nodes;</span><br><span class="line">    <span class="comment">//最大重定向次数</span></span><br><span class="line">    <span class="keyword">private</span> Integer maxRedirects;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
<li><p>建立连接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisClusterConfig</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ClusterConfigurationProperties clusterProperties;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisConnectionFactory <span class="title function_">connectionFactory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">RedisClusterConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisClusterConfiguration</span>(clusterProperties.getMaxRedirects());</span><br><span class="line">        configuration.setMaxRedirects(clusterProperties.getMaxRedirects());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JedisConnectionFactory</span>(configuration);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, String&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionfactory)</span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, String&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">redisTemplate</span>&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionfactory);</span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

</li>
<li><p>采用统一控制缓存逻辑，使用拦截器实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Interceptor</span>()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.equalsIgnoreCase(request.getMethod(), <span class="string">&quot;OPTIONS&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断请求方式</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.equalsIgnoreCase(request.getMethod(), <span class="string">&quot;GET&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">//非Get，如果不是graphql，则放行</span></span><br><span class="line">            <span class="keyword">if</span>(!StringUtils.equalsIgnoreCase(request.getRequestURI(), <span class="string">&quot;/graphql&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//通过缓存做命中，查询redis，redisKey ? 组成md5</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> createRedisKey(request);</span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="built_in">this</span>.redisTemplate.opsForValue().get(redisKey);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(data)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//支持跨域</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;GET,POST,PUT,DELETE,OPTIONS&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Content-Type,X-Token&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        response.getWriter().write(data);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createRedisKey</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">paramStr</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line">        <span class="keyword">if</span>(parameterMap.isEmpty())&#123;</span><br><span class="line">            paramStr += IOUtils.toString(request.getInputStream(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            paramStr += mapper.writeValueAsString(request.getParameterMap());</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将拦截器注入Spring容器</p>
<ul>
<li>将数据库查询结果写入Redis缓存中<ul>
<li>使用<strong>ResponseBodyAdvice</strong> 在响应结果被处理前拦截，拦截的逻辑自己实现，这样就可以将响应结果写入缓存中了<ul>
<li>@ControllerAdvice进行拦截</li>
<li>supprot方法返回true才会执行beforeBodyWrite方法</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E9%9B%86%E7%BE%A4/" data-id="clrj8pzxx008p6wuwb85j7dh7" data-title="集群" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9B%86%E7%BE%A4/" rel="tag">集群</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Note/后端/Java/开发/系统设计" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.691Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><h3 id="CRM（客户关系管理系统）"><a href="#CRM（客户关系管理系统）" class="headerlink" title="CRM（客户关系管理系统）"></a>CRM（客户关系管理系统）</h3><ul>
<li>应用<ul>
<li>OA系统、HR系统</li>
</ul>
</li>
</ul>
<h3 id="SRM（供应商关系管理系统）"><a href="#SRM（供应商关系管理系统）" class="headerlink" title="SRM（供应商关系管理系统）"></a>SRM（供应商关系管理系统）</h3><ul>
<li>应用<ul>
<li>进销存系统</li>
</ul>
</li>
</ul>
<h3 id="SCM（供应链管理系统）"><a href="#SCM（供应链管理系统）" class="headerlink" title="SCM（供应链管理系统）"></a>SCM（供应链管理系统）</h3><ul>
<li>应用<ul>
<li>数据中台</li>
</ul>
</li>
</ul>
<h3 id="SaaS（软件即服务）"><a href="#SaaS（软件即服务）" class="headerlink" title="SaaS（软件即服务）"></a>SaaS（软件即服务）</h3><ul>
<li>开箱即用</li>
<li>应用<ul>
<li>第三方系统、OA系统、HR系统、网盘</li>
</ul>
</li>
</ul>
<h3 id="PaaS（平台即服务）"><a href="#PaaS（平台即服务）" class="headerlink" title="PaaS（平台即服务）"></a>PaaS（平台即服务）</h3><ul>
<li>应用<ul>
<li>开源系统、第三方Api&#x2F;服务</li>
</ul>
</li>
</ul>
<h3 id="IaaS（基础架构即服务）"><a href="#IaaS（基础架构即服务）" class="headerlink" title="IaaS（基础架构即服务）"></a>IaaS（基础架构即服务）</h3><ul>
<li>应用<ul>
<li>虚拟机、云存储、云服务器</li>
</ul>
</li>
</ul>
<h2 id="项目开发流程"><a href="#项目开发流程" class="headerlink" title="项目开发流程"></a>项目开发流程</h2><ol>
<li>设计产品原型</li>
<li>需求分析</li>
<li>模块设计</li>
<li>接口文档</li>
<li>前后端分离开发</li>
<li>测试</li>
<li>部署上线</li>
</ol>
<h2 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h2><ul>
<li>多级缓存一致性</li>
<li>事务一致性</li>
</ul>
<h2 id="稳定性"><a href="#稳定性" class="headerlink" title="稳定性"></a>稳定性</h2><ul>
<li>有异常但不影响使用，但是要刨根问底的解决</li>
</ul>
<h2 id="平滑性"><a href="#平滑性" class="headerlink" title="平滑性"></a>平滑性</h2><ul>
<li>项目部署</li>
</ul>
<h2 id="产品技术思维"><a href="#产品技术思维" class="headerlink" title="产品技术思维"></a>产品技术思维</h2><ul>
<li>即很多技术问题可以通过业务手段来规避<ul>
<li>12315为例<ul>
<li>存储的性能的挑战</li>
<li>通过分时段售票，候补票机制，验证码等等规避</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="反常规设计"><a href="#反常规设计" class="headerlink" title="反常规设计"></a>反常规设计</h2><ul>
<li>12306抢票设计<ul>
<li>通过分时段抢票、候补票等机制规避了超高并发的设计困难</li>
</ul>
</li>
</ul>
<h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><h2 id="类关系设计"><a href="#类关系设计" class="headerlink" title="类关系设计"></a>类关系设计</h2><ul>
<li>关联关系<ul>
<li>单 &#x2F; 双&#x2F; 自 关联</li>
</ul>
</li>
<li>聚合关系<ul>
<li>整体和部分的关联</li>
<li>部分可以脱离整体对象并独立存在</li>
</ul>
</li>
<li>组合关系<ul>
<li>整体和部分的关联，更强烈的聚合关系</li>
<li>部分不能脱离整体对象并独立存在</li>
</ul>
</li>
<li>继承 &#x2F; 泛化关系</li>
<li>实现关系</li>
<li>依赖关系<ul>
<li>是一种使用关系，耦合度最低</li>
<li>是一种临时性的关联</li>
<li>例如调用某个类的局部变量&#x2F;静态方法，作为方法的入参</li>
</ul>
</li>
</ul>
<h2 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h2><ul>
<li>接口单一职责<ul>
<li>一个接口只处理一种类型的任务</li>
</ul>
</li>
<li>接口隔离原则<ul>
<li>接口实现类不应该被迫依赖其不使用的方法</li>
<li>一个类对另一个类的依赖应该建立在实现最少的接口</li>
</ul>
</li>
<li>依赖倒装原则<ul>
<li>如controller不直接使用接口实现类，而是使用的接口提供的方法</li>
<li>即高层模块不依赖低层模块，两者都应该依赖其抽象接口</li>
<li>对抽象进行编程，而不是对实现进行编程</li>
</ul>
</li>
<li>合成复用原则<ul>
<li>尽量使用聚合、关联、组合等类的关系，其次在考虑继承</li>
</ul>
<p>	</p>
</li>
<li>里氏替换原则<ul>
<li>在使用父类的地方，其子类可以完全替换其父类</li>
<li>子类应该扩展父类的方法，但不要重写父类的方法</li>
</ul>
</li>
<li>迪米特法则<ul>
<li>两个实体最好不要直接通信，最好通过第三方通信</li>
</ul>
</li>
<li>开闭原则<ul>
<li>对修改封闭，对扩展开放</li>
<li>在程序需要扩展时不应该去修改源代码，而是实现一种热插拔的形式</li>
<li>程序设计扩展性要好、易维护、易升级</li>
<li>即尽量使用接口和抽象类</li>
</ul>
</li>
</ul>
<h2 id="创建型设计模式"><a href="#创建型设计模式" class="headerlink" title="创建型设计模式"></a>创建型设计模式</h2><h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//饿汉构造</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hungry</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Hungry</span> <span class="variable">HUNGRY</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hungry</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Hungry</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span>  <span class="title class_">Hungry</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//饿汉代码块</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hungry</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Hungry HUNGRY;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">/*一般在这个静态代码块中加载配置*/</span></span><br><span class="line">        HUNGRY = <span class="keyword">new</span> <span class="title class_">Hungry</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Hungry</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//懒汉构造</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lazy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Lazy</span> <span class="variable">lazy</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Lazy</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="comment">//锁的粒度比较粗</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Lazy <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (lazy == <span class="literal">null</span>)</span><br><span class="line">            <span class="type">return</span> <span class="variable">lazy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lazy</span>();</span><br><span class="line">        <span class="keyword">return</span> lazy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//双重检查锁</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Lazy</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="comment">//防止指令重排和使用到半初始化状态的对象</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Lazy</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Lazy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//防止反射破坏单例</span></span><br><span class="line">        <span class="keyword">synchronized</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;不能创建多个单例对象&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Lazy <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//提高效率，当有实例了不用再去争抢锁</span></span><br><span class="line">        <span class="keyword">if</span>(INSTANCE == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Lazy.class) &#123;</span><br><span class="line">                <span class="comment">//防止阻塞队列的线程重新创建对象</span></span><br><span class="line">                <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>)</span><br><span class="line">                    <span class="type">return</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lazy</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//防止反序列化时返回新的对象</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResovle</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//内部类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Lazy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Lazy</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">inner</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Lazy</span> <span class="variable">LAZY</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lazy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Lazy <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> inner.LAZY;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><h3 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h3><ul>
<li>用于构造复杂对象</li>
<li>包含四个角色<ul>
<li>抽象建造者类（Builder）：接口</li>
<li>具体建造者类（ConcreteBuilder）：实现Builder接口</li>
<li>产品类（Product）：要构造的复杂对象</li>
<li>指挥者类（Director）：调用ConcreteBuilder来创建Product复杂对象</li>
</ul>
</li>
</ul>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><ul>
<li>需要频繁创建对象的场景，并且这些对象都属于同一种类型</li>
<li>通过clone方式实现对象创建</li>
<li>一般结合工厂模式实现</li>
<li>使用场景<ul>
<li>账单推送</li>
</ul>
</li>
</ul>
<h2 id="结构型设计模式"><a href="#结构型设计模式" class="headerlink" title="结构型设计模式"></a>结构型设计模式</h2><h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3><ul>
<li>部分整体</li>
<li>定义个各层次对象的共有方法和属性，预先定义一些默认的行为</li>
<li>定义非叶子节点的行为，存储子节点，组合非叶子节点和叶子节点形成树</li>
<li>定义叶子节点下无分支</li>
<li>有透明组合模式和安全组合模式<ul>
<li>透明组合模式是标准模式<ul>
<li>不安全，叶子节点不应该具有添加、删除等功能</li>
</ul>
</li>
<li>安全组合模式<ul>
<li>安全，不同的节点提供其对应的方法，实现复杂</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h3><ul>
<li>扩展新的访问方式</li>
<li>使用场景<ul>
<li>适用与调用端较多、需求变化频繁的场景</li>
</ul>
</li>
</ul>
<h2 id="行为型设计模式"><a href="#行为型设计模式" class="headerlink" title="行为型设计模式"></a>行为型设计模式</h2><h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><h3 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h3><ul>
<li>有性能问题和类膨胀问题<ul>
<li>采用的是递归的调用方式，复杂度比较高，而且不容易debug，代码维护比较麻烦</li>
<li>每个解释器的语法的结束都会产生一个非终结符表达式，导致类文件过多膨胀，不好维护</li>
</ul>
</li>
</ul>
<h3 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h3><ul>
<li>提高现有代码的扩展能力</li>
<li>代码中提供增加扩展的方法，可以用一个集合存放可能扩展的功能接口，然后再代码中遍历调用</li>
<li>大致的实现确定，少部分不确定的，就可以将这部分设计为模板</li>
<li>这部分将推迟实现，提高代码复用性，实现反向控制</li>
<li>使用场景<ul>
<li>处理用户行为日志</li>
</ul>
</li>
</ul>
<h2 id="代码设计"><a href="#代码设计" class="headerlink" title="代码设计"></a>代码设计</h2><h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><ul>
<li><p>将调用方和类解耦，将具体业务放在工厂类中实现</p>
<ul>
<li>封装了创建对象的过程，避免了修改调用方代码，更容易扩展</li>
<li>虽然解除了调用方和类的耦合，但是产生了新的耦合，即工厂类和类的耦合，修改业务时依然需要修改工厂类代码，违背了开闭原则</li>
</ul>
</li>
<li><p>可以把工厂类中的业务方法定义为静态的，方便调用</p>
</li>
</ul>
<h3 id="两阶段终止模式"><a href="#两阶段终止模式" class="headerlink" title="两阶段终止模式"></a>两阶段终止模式</h3><ul>
<li>一个线程t1 优雅的停止另一个线程t2，给t2一个料理后事的机会</li>
<li>如果直接终止t2会导致t2锁住的资源无法释放，导致死锁</li>
</ul>
<h1 id="分布式设计"><a href="#分布式设计" class="headerlink" title="分布式设计"></a>分布式设计</h1><h2 id="分布式寻址"><a href="#分布式寻址" class="headerlink" title="分布式寻址"></a>分布式寻址</h2><h3 id="哈希取余分区"><a href="#哈希取余分区" class="headerlink" title="哈希取余分区"></a>哈希取余分区</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><ul>
<li>根据集群数量哈希取余，均匀的分配到每一台机器上</li>
</ul>
<h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><ul>
<li>优点是简单</li>
<li>缺点是不利于扩容，还有就是如果节点宕机需要重新取余，不稳定</li>
</ul>
<h3 id="一致性哈希算法分区"><a href="#一致性哈希算法分区" class="headerlink" title="一致性哈希算法分区"></a>一致性哈希算法分区</h3><h4 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h4><ul>
<li>对2^32^ 取余</li>
</ul>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ul>
<li>算法构建一致性哈希环<ul>
<li>将 0 ~ 2^32^ 的线性空间拼接成一个环</li>
</ul>
</li>
<li>服务器IP节点映射到这个哈希环上</li>
<li>key落到服务器的落键规则<ul>
<li>请求同样对2^32^ 取余，然后落在环上顺时针走，遇到的第一个服务器就处理这个请求</li>
</ul>
</li>
</ul>
<h4 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点</h4><ul>
<li>优点<ul>
<li>容错性高、扩展性强</li>
</ul>
</li>
<li>缺点<ul>
<li>节点太少回导致数据倾斜的问题<ul>
<li>通过虚拟节点解决</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="哈希槽分区"><a href="#哈希槽分区" class="headerlink" title="哈希槽分区"></a>哈希槽分区</h3><h4 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h4><ul>
<li>用一个 2^14^ 大的数组，作为哈希槽</li>
<li>最多只有16384个槽</li>
<li>因为redis的节点不会超过1000个，够用了</li>
<li>相当于在请求和redis之间添加了一个反向代理（槽），由它来选择存储的redis节点</li>
</ul>
<h2 id="幂等性"><a href="#幂等性" class="headerlink" title="幂等性"></a>幂等性</h2><h3 id="接口幂等"><a href="#接口幂等" class="headerlink" title="接口幂等"></a>接口幂等</h3><ul>
<li>同一个接口请求多次结果相同</li>
</ul>
<h4 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h4><ol>
<li>把传入的数据md5转换后存入redis，使用setnx存入</li>
<li>数据库唯一约束</li>
<li>前端发请求携带一个额外的token，两次token一致则不执行</li>
<li>加乐观锁（csa）</li>
<li>状态机</li>
<li>插入前先查找</li>
<li>加悲观锁</li>
</ol>
<h2 id="分布式缓存"><a href="#分布式缓存" class="headerlink" title="分布式缓存"></a>分布式缓存</h2><ol>
<li>Redis哨兵集群、分片集群</li>
</ol>
<h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><ol>
<li>MySQL实现<ul>
<li>创建一张锁表，加锁时在锁表中添加一条记录，释放锁时删除记录</li>
<li>如果有并发请求同时提交到数据库，数据库会保证只有一个请求能够得到锁</li>
<li>属于数据库 IO 操作，效率不高，而且频繁操作会增大数据库的开销，因此这种方式在高并发、高性能的场景中用的不多</li>
</ul>
</li>
<li>ZooKeeper实现<ul>
<li>是一个比较重的分布式组件</li>
</ul>
</li>
<li>Redis实现<ul>
<li>setNx，需要加入过期时间</li>
<li>Redission</li>
</ul>
</li>
</ol>
<h2 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h2><h3 id="XA协议"><a href="#XA协议" class="headerlink" title="XA协议"></a>XA协议</h3><ul>
<li>因为多个事务在多个不同的节点上执行，其中一个节点失败或者延迟，往往会导致整个系统的一致性受到破坏</li>
<li>角色<ul>
<li>AP（Application）：应用系统（服务）</li>
<li>TM（Transaction Manager）：事务管理器（全局事务管理）</li>
<li>RM（Resource Manager）：资源管理器（数据库）</li>
</ul>
</li>
</ul>
<h3 id="具体实现-1"><a href="#具体实现-1" class="headerlink" title="具体实现"></a>具体实现</h3><ol>
<li>两阶段提交（2PC）<ul>
<li>可以保证事务的原子性和一致性，但是需要额外的开销和时间，不适合高并发和高吞吐的系统</li>
<li>整个过程中事务管理器（TM）很关键，如果其宕机会导致资源管理器（RM）不可用</li>
<li>事务处理过程中资源管理器（RM）处于阻塞状态，事务提交后才释放资源</li>
<li>由于网络问题可能出现数据不一致的问题（部分节点没有接收到Commit操作）</li>
</ul>
</li>
<li>三阶段提交（3PC）<ul>
<li>为解决两阶段提交协议的单点故障和同步阻塞问题</li>
<li>步骤<ul>
<li>CanCommit：准备阶段。协调者向参与者发送commit请求，参与者如果可以提交就返回Yes响应，否则返回No响应</li>
<li>PreCommit：预提交阶段。协调者根据参与者在<strong>准备阶段</strong>的响应判断是否执行事务还是中断事务，参与者执行完操作之后返回ACK响应，同时开始等待最终指令</li>
<li>DoCommit：提交阶段。协调者根据参与者在<strong>准备阶段</strong>的响应判断是否执行事务还是中断事务</li>
</ul>
</li>
</ul>
</li>
<li>补偿机制（TCC）<ul>
<li>在业务层实现的分布式事务，保证最终一致性<ul>
<li>配合状态机实现</li>
<li>Try：资源检测和预留</li>
<li>Confirm：完成资源操作业务，Try成功，Confirm一定要能成功</li>
<li>Cancel：预留资源释放，可以看作是try的反向操作，即回滚</li>
</ul>
</li>
<li>规避了两阶段提交数据库性能低下的问题</li>
<li>由于在业务层实现，所以开发成本高，对业务侵入较大和耦合度高</li>
</ul>
</li>
<li>消息队列<ul>
<li>使用MQ的事务消息机制</li>
<li>将事务的各个阶段转化为消息的处理，以此来确保事务的顺序性和一致性</li>
<li>存在延迟和数据重复的问题</li>
</ul>
</li>
<li>本地消息表<ul>
<li>将分布式事务拆分成本地事务进行处理，属于最终一致性</li>
<li>步骤<ul>
<li>在数据库中新增一张消息表，将事务操作记录到消息表中（两个操作在一个事务中）</li>
<li>通过轮询的方式将消息表中新增的消息推送到mq，数据库再去mq中消费信息（保证幂等）</li>
<li>数据库处理完成后</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h3><ol>
<li>Seata<ul>
<li>使用的是两阶段提交</li>
</ul>
</li>
</ol>
<h2 id="分布式限流"><a href="#分布式限流" class="headerlink" title="分布式限流"></a>分布式限流</h2><h3 id="限流算法"><a href="#限流算法" class="headerlink" title="限流算法"></a>限流算法</h3><ol>
<li>计数器<ul>
<li>设置单位时间内能够处理的最大请求数</li>
<li>存在浪费性能的问题<ul>
<li>请求可能在单位时间内早就处理完成了，剩余的时间没处理请求，资源浪费</li>
<li>该问题也称为 突刺现象</li>
</ul>
</li>
</ul>
</li>
<li>漏桶算法<ul>
<li>漏桶流算法</li>
<li>令牌桶算法</li>
</ul>
</li>
</ol>
<h2 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" data-id="clrj8pzxv008d6wuwcd70aqvs" data-title="系统设计" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Note/后端/Java/开发/框架设计" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.691Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/">框架设计</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="实体类设计"><a href="#实体类设计" class="headerlink" title="实体类设计"></a>实体类设计</h2><ul>
<li>继承Model实现CRUD</li>
<li>前提是需要有对应的Mapper类并基础BaseMapper&lt;T&gt;</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">Model</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">test</span><span class="params">(UserParam userParam)</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    Beanutil.copyProperty(userParam, user);</span><br><span class="line">    <span class="comment">//增</span></span><br><span class="line">    user.insert();</span><br><span class="line">    <span class="comment">//删</span></span><br><span class="line">    user.deleteById();</span><br><span class="line">    <span class="comment">//改</span></span><br><span class="line">    user.updateById();</span><br><span class="line">    user.update(UpdateWrappers&lt;User&gt;对象);</span><br><span class="line">    <span class="comment">//查</span></span><br><span class="line">    user.selectById();</span><br><span class="line">    user.selectOne(QueryWrappers&lt;User&gt;对象);</span><br><span class="line">    user.selectPage(IPage对象, QueryWrappers&lt;User&gt;对象);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>重要数据的dto都需要继承该类，然后通过mybatis填充器自动填充操作信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">public class DbEntity&lt;T&gt; &#123;</span><br><span class="line">    //创建时间</span><br><span class="line">    @TableField(fill = FieldFill.INSERT)</span><br><span class="line">    private Date createTime;</span><br><span class="line"></span><br><span class="line">    //修改时间</span><br><span class="line">    @TableField(fill = FieldFill.INSERT_UPDATE)</span><br><span class="line">    private Date updateTime;</span><br><span class="line">    </span><br><span class="line">    //创建者ID</span><br><span class="line">    @TableField(fill = FieldFill.INSERT)</span><br><span class="line">    private T createBy;</span><br><span class="line">    </span><br><span class="line">    //修改着ID</span><br><span class="line">    @TableField(fill = FieldFill.INSERT_UPDATE)</span><br><span class="line">    private T updateBy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据字典"><a href="#数据字典" class="headerlink" title="数据字典"></a>数据字典</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul>
<li><p>构成</p>
<ul>
<li>字典组 -&gt; key-value</li>
</ul>
</li>
<li><p>字典可以做缓存，使用redis和lfu缓存淘汰策略</p>
</li>
</ul>
<h3 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h3><p>字典组</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>id</td>
</tr>
<tr>
<td>type</td>
<td>varchar</td>
<td>字典组名</td>
</tr>
<tr>
<td>show</td>
<td>char</td>
<td>表现形式 0 列表 1 树形</td>
</tr>
<tr>
<td>category</td>
<td>varchar</td>
<td>字典类型 系统内置、业务类</td>
</tr>
<tr>
<td>des</td>
<td>varchar</td>
<td>描述</td>
</tr>
<tr>
<td>remark</td>
<td>varchar</td>
<td>备注</td>
</tr>
</tbody></table>
<p>字典项</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td></td>
<td></td>
</tr>
<tr>
<td>pid</td>
<td></td>
<td>字典组id</td>
</tr>
<tr>
<td>type</td>
<td></td>
<td>字典组名</td>
</tr>
<tr>
<td>key</td>
<td></td>
<td>字典项key</td>
</tr>
<tr>
<td>value</td>
<td></td>
<td>字典项value</td>
</tr>
<tr>
<td>sort</td>
<td></td>
<td>排序值</td>
</tr>
<tr>
<td>des</td>
<td></td>
<td>描述</td>
</tr>
<tr>
<td>remark</td>
<td></td>
<td>备注</td>
</tr>
</tbody></table>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ul>
<li><p>Controller</p>
<ul>
<li>新增字典组</li>
<li>分页查询字典组信息</li>
<li>修改字典组</li>
<li>通过id删除字典组</li>
<li>新增字典项</li>
<li>分页查询字典项信息</li>
<li>修改字典项</li>
<li>树形查询字典项信息</li>
<li>通过id删除字典项</li>
<li>获取字典值 value</li>
<li>获取key-value</li>
<li>获取树形的key-value</li>
<li>获取key-value 无权限</li>
<li>获取字典值 value 无权限（无权限组）</li>
</ul>
</li>
<li><p>service</p>
</li>
<li><p>Impl</p>
<ul>
<li>注入DictServiceImpl（可以通过ApplicationContext）</li>
</ul>
</li>
<li><p>Mapper</p>
<ul>
<li>SysDictGroupMapper</li>
<li>SysDictMapper</li>
</ul>
</li>
</ul>
<h2 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h2><h3 id="异常响应类"><a href="#异常响应类" class="headerlink" title="异常响应类"></a>异常响应类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefRunException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> ExceptionEnum ex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefRunException</span><span class="params">(<span class="keyword">final</span> ExceptionEnum ex, <span class="keyword">final</span> String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        init(ex, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefRunException</span><span class="params">(<span class="keyword">final</span> ExceptionEnum ex, <span class="keyword">final</span> String message, <span class="keyword">final</span> Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">        init(ex, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ExceptionEnum ex, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.ex = ex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异常断言接口"><a href="#异常断言接口" class="headerlink" title="异常断言接口"></a>异常断言接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ExceptionAssert</span> &#123;</span><br><span class="line">    <span class="comment">//创建异常</span></span><br><span class="line">    DefRunException <span class="title function_">newException</span><span class="params">(Object... args)</span>;</span><br><span class="line">    DefRunException <span class="title function_">newException</span><span class="params">(Throwable t, Object... args)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//断言该对象不能为空对象</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">assertNotNull</span><span class="params">(Object obj, Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newException(args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="keyword">if</span> (((String) obj).length() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> newException(args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//断言是否True，是True则测试用例通过。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">assertTrue</span><span class="params">(<span class="type">boolean</span> isTrue, Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isTrue) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newException(args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//断言是否False，是False则测试用例通过。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">assertFalse</span><span class="params">(<span class="type">boolean</span> isTrue, Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isTrue) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newException(args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//有一个为 null</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">hasEmpty</span><span class="params">(String msg, Object... object)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtil.hasEmpty(object)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newException(ObjectUtil.isNull(msg) ? <span class="string">&quot;参数不能为null!&quot;</span> : msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异常枚举类"><a href="#异常枚举类" class="headerlink" title="异常枚举类"></a>异常枚举类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsment</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ExceptionEnum</span> <span class="keyword">implements</span> <span class="title class_">ExceptionAssert</span> &#123;</span><br><span class="line">    <span class="comment">//内部异常（打印日志）</span></span><br><span class="line">    INNER_MSG(<span class="string">&quot;&#123;0&#125;&quot;</span>),</span><br><span class="line">    <span class="comment">//异常信息（返回给客户端异常信息）</span></span><br><span class="line">    CLIENT_MSG(<span class="string">&quot;&#123;0&#125;&quot;</span>),</span><br><span class="line">    <span class="comment">//异常编码，配置异常信息，返回给客户端</span></span><br><span class="line">    CLIENT_CODE(<span class="string">&quot;&#123;0&#125;&quot;</span>),</span><br><span class="line">    ;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DefRunException <span class="title function_">newException</span><span class="params">(Object... args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> MessageFormat.format(<span class="built_in">this</span>.getMessage(), args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefRunException</span>(<span class="built_in">this</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DefRunException <span class="title function_">newException</span><span class="params">(Throwable t, Object... args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> MessageFormat.format(<span class="built_in">this</span>.getMessage(), args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefRunException</span>(<span class="built_in">this</span>, msg, t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//直接抛配置好的异常信息给客户端</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">th</span><span class="params">(Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> newException(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//直接抛内部异常，打印日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">thro</span><span class="params">(Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> INNER_MSG.newException(args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//格式化输出 (&quot;aa &#123;&#125;&quot;, &quot;aa&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">format</span><span class="params">(String msg, Object... objects)</span> &#123;</span><br><span class="line">        <span class="type">FormattingTuple</span> <span class="variable">ft</span> <span class="operator">=</span> MessageFormatter.arrayFormat(msg, objects);</span><br><span class="line">        <span class="keyword">return</span> ft.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异常拦截器"><a href="#异常拦截器" class="headerlink" title="异常拦截器"></a>异常拦截器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionCatch</span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(想要拦截的异常)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">exception</span><span class="params">()</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        Log...;</span><br><span class="line">        <span class="keyword">return</span> R;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全局返回值"><a href="#全局返回值" class="headerlink" title="全局返回值"></a>全局返回值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">ok</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(CommonConstants.SUCCESS, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">ok</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(CommonConstants.SUCCESS, <span class="literal">null</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">failed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(CommonConstants.FAIL, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">failed</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(CommonConstants.FAIL, msg, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">bol</span><span class="params">(<span class="type">boolean</span> result)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bol(result, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">bol</span><span class="params">(<span class="type">boolean</span> result, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> result ? R.ok() : R.failed(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">bol</span><span class="params">(T t, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.nonNull(t) ? R.ok(t) : R.failed(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全局常量信息"><a href="#全局常量信息" class="headerlink" title="全局常量信息"></a>全局常量信息</h2><ul>
<li>异常信息枚举类<ul>
<li>各种异常信息状态码和友好响应信息</li>
</ul>
</li>
<li>全局状态信息枚举类</li>
</ul>
<h2 id="全局配置信息处理"><a href="#全局配置信息处理" class="headerlink" title="全局配置信息处理"></a>全局配置信息处理</h2><ol>
<li><p>创建一个抽象类，提供一个抽象方法并在创建时初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SettingEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        defaultValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 必须初始化值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">defaultValue</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建需要全局统一管理的配置信息对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Gs</span> <span class="keyword">extends</span> <span class="title class_">GsSettingEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1629258515233154346L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对象内部要对值进行初始化，也需要继承 GsSettingEntity</span></span><br><span class="line">    <span class="meta">@Valid</span></span><br><span class="line">    <span class="keyword">private</span> Gs1 gs1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Valid</span></span><br><span class="line">    <span class="keyword">private</span> String str;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">defaultValue</span><span class="params">()</span> &#123;</span><br><span class="line">        gs1 = <span class="keyword">new</span> <span class="title class_">Gs1</span>();</span><br><span class="line">        <span class="built_in">this</span>.str = <span class="string">&quot;默认值&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="全局分页处理"><a href="#全局分页处理" class="headerlink" title="全局分页处理"></a>全局分页处理</h2><h3 id="分页入参"><a href="#分页入参" class="headerlink" title="分页入参"></a>分页入参</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">getPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> HttpServletUtil.getRequest();</span><br><span class="line">        <span class="keyword">switch</span> (HttpMethod.valueOf(request.getMethod())) &#123;</span><br><span class="line">            <span class="keyword">case</span> GET:</span><br><span class="line">                <span class="keyword">return</span> getPageOfGetReq(request);</span><br><span class="line">            <span class="keyword">case</span> POST:</span><br><span class="line">                <span class="comment">// TODO</span></span><br><span class="line">            <span class="keyword">default</span>:<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;T&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">getPageOfGetReq</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">p</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (ContentType.JSON.equals(request.getContentType())) &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ps = request.getParameter(CommonConstants.PAGE_SIZE);</span><br><span class="line">            p = request.getParameter(CommonConstants.PAGE_CURRENT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;T&gt;(Convert.toInt(p, CommonConstants.PAGE_CURRENT_DEFAULT), Convert.toInt(ps, CommonConstants.PAGE_SIZE_DEFAULT));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分页返回处理"><a href="#分页返回处理" class="headerlink" title="分页返回处理"></a>分页返回处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;S, T&gt; IPage&lt;T&gt; <span class="title function_">covert</span><span class="params">(IPage&lt;S&gt; s, Class&lt;T&gt; t, Function&lt;S, T&gt; convert)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(s);</span><br><span class="line">        Page&lt;T&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(s.getCurrent(), s.getSize(), s.getTotal());</span><br><span class="line">        page.setPages(s.getPages());</span><br><span class="line">        List&lt;S&gt; data = s.getRecords();</span><br><span class="line">        page.setRecords(data.stream().map(convert).collect(Collectors.toList()));</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;S, T&gt; IPage&lt;T&gt; <span class="title function_">covert</span><span class="params">(IPage&lt;S&gt; s, List&lt;S&gt; data, Class&lt;T&gt; t, Function&lt;S, T&gt; convert)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(s);</span><br><span class="line">        Objects.requireNonNull(data);</span><br><span class="line">        Page&lt;T&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(s.getCurrent(), s.getSize(), data.size());</span><br><span class="line">        page.setRecords(data.stream().map(convert).collect(Collectors.toList()));</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全局导入导出"><a href="#全局导入导出" class="headerlink" title="全局导入导出"></a>全局导入导出</h2><p>使用EasyExcel</p>
<h3 id="动态列宽"><a href="#动态列宽" class="headerlink" title="动态列宽"></a>动态列宽</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态列宽</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelCellWidthStyleStrategy</span> <span class="keyword">extends</span> <span class="title class_">AbstractColumnWidthStyleStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_COLUMN_WIDTH</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">private</span>  Map&lt;String, Map&lt;Integer, Integer&gt;&gt; CACHE = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setColumnWidth</span><span class="params">(WriteSheetHolder writeSheetHolder, List&lt;WriteCellData&lt;?&gt;&gt; cellDataList, Cell cell, Head head, Integer relativeRowIndex, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">needSetWidth</span> <span class="operator">=</span> isHead || !CollectionUtils.isEmpty(cellDataList);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> Objects.isNull(writeSheetHolder.getSheetNo()) ? writeSheetHolder.getSheetName(): writeSheetHolder.getSheetNo() + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (needSetWidth) &#123;</span><br><span class="line">            <span class="comment">// 获取 key -&gt; sheet 页各列的 宽度信息</span></span><br><span class="line">            Map&lt;Integer, Integer&gt; maxColumnWidthMap = CACHE.get(key);</span><br><span class="line">            <span class="keyword">if</span> (maxColumnWidthMap == <span class="literal">null</span>) &#123;</span><br><span class="line">                maxColumnWidthMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">                CACHE.put(key, maxColumnWidthMap);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 计算当前 单元格 内容的大小</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">columnWidth</span> <span class="operator">=</span> <span class="built_in">this</span>.dataLength(cellDataList, cell, isHead);</span><br><span class="line">            <span class="keyword">if</span> (columnWidth &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (columnWidth &gt; MAX_COLUMN_WIDTH) &#123;</span><br><span class="line">                    columnWidth = MAX_COLUMN_WIDTH;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Integer</span> <span class="variable">maxColumnWidth</span> <span class="operator">=</span> maxColumnWidthMap.get(cell.getColumnIndex());</span><br><span class="line">                <span class="comment">// 若当前单元格的大小大约该列最大值 更新该列宽度 并记录</span></span><br><span class="line">                <span class="keyword">if</span> (maxColumnWidth == <span class="literal">null</span> || columnWidth &gt; maxColumnWidth) &#123;</span><br><span class="line">                    maxColumnWidthMap.put(cell.getColumnIndex(), columnWidth);</span><br><span class="line">                    writeSheetHolder.getSheet().setColumnWidth(cell.getColumnIndex(), columnWidth * <span class="number">256</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer <span class="title function_">dataLength</span><span class="params">(List&lt;WriteCellData&lt;?&gt;&gt; cellDataList, Cell cell, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isHead) &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.min(cell.getStringCellValue().getBytes().length, <span class="string">&quot;默认宽度&quot;</span>.getBytes().length);</span><br><span class="line">            <span class="comment">// 以内容长度作为主要宽度 head 长度不作为主要宽度</span></span><br><span class="line">            <span class="comment">// return cell.getStringCellValue().getBytes().length;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            CellData&lt;?&gt; cellData = cellDataList.get(<span class="number">0</span>);</span><br><span class="line">            <span class="type">CellDataTypeEnum</span> <span class="variable">type</span> <span class="operator">=</span> cellData.getType();</span><br><span class="line">            <span class="keyword">if</span> (type == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">                    <span class="keyword">case</span> STRING:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getStringValue().getBytes().length;</span><br><span class="line">                    <span class="keyword">case</span> BOOLEAN:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getBooleanValue().toString().getBytes().length;</span><br><span class="line">                    <span class="keyword">case</span> NUMBER:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getNumberValue().toString().getBytes().length;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="动态单元格"><a href="#动态单元格" class="headerlink" title="动态单元格"></a>动态单元格</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态单元格</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseExcelCellStyleStrategy</span> <span class="keyword">implements</span> <span class="title class_">CellWriteHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  Map&lt;String, Map&lt;Integer, String&gt;&gt; CACHE = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeCellCreate</span><span class="params">(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, Row row, Head head, Integer columnIndex, Integer relativeRowIndex, Boolean isHead)</span> &#123;</span><br><span class="line">        setCellStyle(writeSheetHolder, row.getSheet().getWorkbook(), row.getCell(columnIndex &gt; <span class="number">0</span> ? columnIndex - <span class="number">1</span> : columnIndex), isHead);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setCellStyle</span><span class="params">(WriteSheetHolder writeSheetHolder, Workbook workbook, Cell cell, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> Objects.isNull(writeSheetHolder.getSheetNo()) ? writeSheetHolder.getSheetName(): writeSheetHolder.getSheetNo() + <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 key -&gt; sheet 页 列标 和 列信息</span></span><br><span class="line">        Map&lt;Integer, String&gt; columnMap = CACHE.get(key);</span><br><span class="line">        <span class="keyword">if</span> (columnMap == <span class="literal">null</span>) &#123;</span><br><span class="line">            columnMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">            CACHE.put(key, columnMap);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算当前 单元格 内容的大小</span></span><br><span class="line">        <span class="keyword">if</span> (Objects.nonNull(cell)) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> cell.getColumnIndex();</span><br><span class="line">            <span class="type">String</span> <span class="variable">headInfo</span> <span class="operator">=</span> <span class="built_in">this</span>.getCellHeadInfo(cell, isHead);</span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isNotEmpty(headInfo)) &#123;</span><br><span class="line">                columnMap.put(index, headInfo);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                headInfo = columnMap.get(index);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isNotEmpty(headInfo)) &#123;</span><br><span class="line">                <span class="comment">// 有效的头部信息</span></span><br><span class="line">                fillCellStyle(key, headInfo, cell, workbook);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 设置这个单元格的样式</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> sheetName sheetName</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> headInfo 列头信息</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> cell 单元格信息</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> workbook</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">fillCellStyle</span><span class="params">(String sheetName, String headInfo, Cell cell, Workbook workbook)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getCellHeadInfo</span><span class="params">(Cell cell, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isHead) &#123;</span><br><span class="line">            <span class="keyword">return</span> cell.getStringCellValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="日志处理"><a href="#日志处理" class="headerlink" title="日志处理"></a>日志处理</h2><h3 id="接口操作日志"><a href="#接口操作日志" class="headerlink" title="接口操作日志"></a>接口操作日志</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> OperationLog &#123;</span><br><span class="line">    <span class="comment">/** 业务的名称,例如:&quot;修改菜单&quot; */</span></span><br><span class="line">    String <span class="title function_">title</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 业务操作类型枚举 */</span></span><br><span class="line">    LogOpTypeEnum <span class="title function_">opType</span><span class="params">()</span> <span class="keyword">default</span> LogOpTypeEnum.OTHER;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">LogOpTypeEnum</span> &#123;</span><br><span class="line">    <span class="comment">//其它 增加   删除    编辑   更新    查询 </span></span><br><span class="line">    OTHER, ADD, DELETE, EDIT, UPDATE, QUERY,  </span><br><span class="line">    <span class="comment">//详情   树   导入   导出   授权   强退  清空  </span></span><br><span class="line">    DETAIL,TREE,IMPORT,EXPORT,GRANT,FORCE,CLEAN,</span><br><span class="line">    <span class="comment">//修改状态 </span></span><br><span class="line">    CHANGE_STATUS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OperationLogAop</span> &#123;</span><br><span class="line">    <span class="comment">//日志切入点</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.bda.huijun.common.web.aop.log.OperationLog)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getLogPointCut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="comment">//操作成功返回结果记录日志</span></span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;getLogPointCut()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span> &#123;</span><br><span class="line">        common(joinPoint, result, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//操作发生异常记录日志</span></span><br><span class="line">    <span class="meta">@AfterThrowing(pointcut = &quot;getLogPointCut()&quot;, throwing = &quot;exception&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterThrowing</span><span class="params">(JoinPoint joinPoint, Exception exception)</span> &#123;</span><br><span class="line">        common(joinPoint, exception, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">common</span><span class="params">(JoinPoint joinPoint, Object obj, <span class="type">boolean</span> isSucess)</span> &#123;</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> methodSignature.getMethod();</span><br><span class="line">        <span class="type">OperationLog</span> <span class="variable">operationLog</span> <span class="operator">=</span> method.getAnnotation(OperationLog.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">account</span> <span class="operator">=</span> ApplicationContextHolder.getBean(LogConfigurationAdapter.class).getLoggingUserId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> AopUtils.getClassName(joinPoint);</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> AopUtils.getMethodName(joinPoint);</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodParameter</span> <span class="operator">=</span> AopUtils.getArgsJsonString(joinPoint);</span><br><span class="line">        <span class="comment">//异步记录日志</span></span><br><span class="line">        <span class="keyword">if</span> (isSucess) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (LogOpTypeEnum.EXPORT == operationLog.opType() || LogOpTypeEnum.IMPORT == operationLog.opType()) &#123;</span><br><span class="line">                result = JSON.toJSONString(R.ok(operationLog.opType().name() + <span class="string">&quot; sucessful!!!&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Objects.nonNull(obj) &amp;&amp; (result = JSON.toJSONString(obj)).length() &gt; <span class="number">256</span>) &#123;</span><br><span class="line">                result = result.substring(<span class="number">0</span>, <span class="number">256</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            LogManager.me().executeOperationLog(operationLog, account, className, methodName, methodParameter, result);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LogManager.me().executeExceptionLog(operationLog, account, className, methodName, methodParameter, (Exception) obj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogManager</span> &#123;</span><br><span class="line">	<span class="comment">//异步操作记录日志的线程池</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ScheduledThreadPoolExecutor</span> <span class="variable">EXECUTOR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScheduledThreadPoolExecutor</span>(<span class="number">10</span>, <span class="keyword">new</span> <span class="title class_">ScheduledExecutorFactoryBean</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LogManager</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//单例模式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">LogManager</span> <span class="variable">LOG_MANAGER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogManager</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LogManager <span class="title function_">me</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LOG_MANAGER;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//异步执行日志的方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">executeLog</span><span class="params">(TimerTask task)</span> &#123;</span><br><span class="line">        <span class="comment">//如果演示模式开启，则不记录日志</span></span><br><span class="line">        <span class="keyword">if</span> (LogProperties.DEMO.equals(LogProperties.me().getModel())) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//日志记录操作延时</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">operateDelayTime</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        EXECUTOR.schedule(task, operateDelayTime, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//登录日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeLoginLog</span><span class="params">(<span class="keyword">final</span> String account, <span class="keyword">final</span> String success, <span class="keyword">final</span> String failMessage)</span> &#123;</span><br><span class="line">        <span class="type">SysVisLog</span> <span class="variable">sysVisLog</span> <span class="operator">=</span> <span class="built_in">this</span>.genBaseSysVisLog();</span><br><span class="line">        <span class="type">TimerTask</span> <span class="variable">timerTask</span> <span class="operator">=</span> LogTaskFactory.loginLog(sysVisLog, account, success, failMessage);</span><br><span class="line">        executeLog(timerTask);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//登出日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeExitLog</span><span class="params">(<span class="keyword">final</span> String account)</span> &#123;</span><br><span class="line">        <span class="type">SysVisLog</span> <span class="variable">sysVisLog</span> <span class="operator">=</span> <span class="built_in">this</span>.genBaseSysVisLog();</span><br><span class="line">        <span class="type">TimerTask</span> <span class="variable">timerTask</span> <span class="operator">=</span> LogTaskFactory.exitLog(sysVisLog, account);</span><br><span class="line">        executeLog(timerTask);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//操作日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeOperationLog</span><span class="params">(OperationLog operationLog, <span class="keyword">final</span> String account, String className, String methodName, String methodParameter, <span class="keyword">final</span> String result)</span> &#123;</span><br><span class="line">        <span class="type">SysOpLog</span> <span class="variable">sysOpLog</span> <span class="operator">=</span> <span class="built_in">this</span>.genBaseSysOpLog();</span><br><span class="line">        <span class="type">TimerTask</span> <span class="variable">timerTask</span> <span class="operator">=</span> LogTaskFactory.operationLog(sysOpLog, account, operationLog, className, methodName, methodParameter, result);</span><br><span class="line">        executeLog(timerTask);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//异常日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeExceptionLog</span><span class="params">(OperationLog operationLog, <span class="keyword">final</span> String account, String className, String methodName, String methodParameter, Exception exception)</span> &#123;</span><br><span class="line">        <span class="type">SysOpLog</span> <span class="variable">sysOpLog</span> <span class="operator">=</span> <span class="built_in">this</span>.genBaseSysOpLog();</span><br><span class="line">        <span class="type">TimerTask</span> <span class="variable">timerTask</span> <span class="operator">=</span> LogTaskFactory.exceptionLog(sysOpLog, account, operationLog, className, methodName, methodParameter, exception);</span><br><span class="line">        executeLog(timerTask);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//构建基础访问日志</span></span><br><span class="line">    <span class="keyword">private</span> SysVisLog <span class="title function_">genBaseSysVisLog</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> HttpServletUtil.getRequest();</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtil.isNotNull(request)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> IpUtils.getClientIP(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> IpAddressUtils.getAddressResult(ip);</span><br><span class="line">            <span class="type">String</span> <span class="variable">browser</span> <span class="operator">=</span> UaUtil.getBrowser(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">os</span> <span class="operator">=</span> UaUtil.getOs(request);</span><br><span class="line">            <span class="keyword">return</span> LogFactory.genBaseSysVisLog(ip, address, browser, os);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;request is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//构建基础操作日志</span></span><br><span class="line">    <span class="keyword">private</span> SysOpLog <span class="title function_">genBaseSysOpLog</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> HttpServletUtil.getRequest();</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtil.isNotNull(request)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> IpUtils.getClientIP(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> IpAddressUtils.getAddressResult(ip);</span><br><span class="line">            <span class="type">String</span> <span class="variable">browser</span> <span class="operator">=</span> UaUtil.getBrowser(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">os</span> <span class="operator">=</span> UaUtil.getOs(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">            <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">            <span class="type">SysOpLog</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.genBaseSysOpLog(ip, address, browser, os, url, method);</span><br><span class="line">            log.setApp(ApplicationContextHolder.getServerName());</span><br><span class="line">            <span class="keyword">return</span> log;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;request is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="logback配置"><a href="#logback配置" class="headerlink" title="logback配置"></a>logback配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="权限处理"><a href="#权限处理" class="headerlink" title="权限处理"></a>权限处理</h2><ul>
<li><p>使用 @PreAuthorize(“@pms.hasPermission(“权限字段”)”) 进行权限配置</p>
</li>
<li><p>主要分为四种使用场景来设计</p>
<ul>
<li><p>外部访问内部有可能造成危险的接口</p>
<ul>
<li>对用户进行登录校验</li>
<li>对用户进行登录校验和权限校验</li>
</ul>
</li>
<li><p>外部访问内部安全的接口</p>
<ul>
<li>通过配置文件配置添加忽略路径</li>
<li>通过 @Inner注解</li>
<li>通过配置类</li>
</ul>
</li>
<li><p>内部访问内部接口</p>
<ul>
<li>通过OpenFeign进行远程调用</li>
</ul>
</li>
<li><p>访问第三方接口</p>
<ul>
<li>通过OpenFeign进行远程调用</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="工具封装"><a href="#工具封装" class="headerlink" title="工具封装"></a>工具封装</h2><h3 id="JWT工具类"><a href="#JWT工具类" class="headerlink" title="JWT工具类"></a>JWT工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// TOKEN的有效期一天(S)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TOKEN_TIME_OUT</span> <span class="operator">=</span> <span class="number">3</span> <span class="number">600</span>;</span><br><span class="line">    <span class="comment">// 加密KEY</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOKEN_ENCRY_KEY</span> <span class="operator">=</span> <span class="string">&quot;MDk4ZjziY200NjIxZDM3M2NhZGUOZTgzMjYyN2I0zjy&quot;</span>;</span><br><span class="line">    <span class="comment">// 最小刷新间隔(S)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REFRESH_TIME</span> <span class="operator">=</span> <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生产ID</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getToken</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        Map&lt;String，Object&gt; claimMaps = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        claimMaps.put(<span class="string">&quot;id&quot;</span>,id);</span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">return</span> Jwts .builder()</span><br><span class="line">            .setId(UUID.randomUUID().toString())</span><br><span class="line">            .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>(currentTime))<span class="comment">//签发时间   </span></span><br><span class="line">            .setSubject(<span class="string">&quot;system&quot;</span>) <span class="comment">//说明</span></span><br><span class="line">            .setIssuer(<span class="string">&quot;heima&quot;</span>) <span class="comment">//签发者信息</span></span><br><span class="line">            .setAudience(<span class="string">&quot;app&quot;</span>)<span class="comment">//接收用户</span></span><br><span class="line">            .compresswith(CompressionCodecs.GZIP) <span class="comment">//数据压缩方式</span></span><br><span class="line">            .signwith(SignatureAlgorithm.HS512，generalKey()) <span class="comment">//加密方式</span></span><br><span class="line">            .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(currentTime + TOKEN_TIME_OUT * <span class="number">1000</span>)) <span class="comment">//过期时间</span></span><br><span class="line">            .addClaims(claimMaps) <span class="comment">//cla信息</span></span><br><span class="line">    		.compact();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Mybatis工具类"><a href="#Mybatis工具类" class="headerlink" title="Mybatis工具类"></a>Mybatis工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">getPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> HttpServletUtil.getRequest();</span><br><span class="line">        <span class="keyword">switch</span> (HttpMethod.valueOf(request.getMethod())) &#123;</span><br><span class="line">            <span class="keyword">case</span> GET:</span><br><span class="line">                <span class="keyword">return</span> getPageOfGetReq(request);</span><br><span class="line">            <span class="keyword">case</span> POST:</span><br><span class="line">                <span class="comment">// TODO</span></span><br><span class="line">            <span class="keyword">default</span>:<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;T&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">getPageOfGetReq</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">p</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (ContentType.JSON.equals(request.getContentType())) &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ps = request.getParameter(CommonConstants.PAGE_SIZE);</span><br><span class="line">            p = request.getParameter(CommonConstants.PAGE_CURRENT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;T&gt;(Convert.toInt(p, CommonConstants.PAGE_CURRENT_DEFAULT), Convert.toInt(ps, CommonConstants.PAGE_SIZE_DEFAULT));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis工具类"><a href="#Redis工具类" class="headerlink" title="Redis工具类"></a>Redis工具类</h3><h3 id="Date工具类"><a href="#Date工具类" class="headerlink" title="Date工具类"></a>Date工具类</h3><h3 id="Security工具类"><a href="#Security工具类" class="headerlink" title="Security工具类"></a>Security工具类</h3><h3 id="Url工具类"><a href="#Url工具类" class="headerlink" title="Url工具类"></a>Url工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UrlUtils</span> &#123;</span><br><span class="line">    <span class="comment">//判断一个字符串是否为url</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isURL</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="comment">//转换为小写</span></span><br><span class="line">        str = str.toLowerCase();</span><br><span class="line">        <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;^((https|http|ftp|rtsp|mms)?://)&quot;</span>  <span class="comment">//https、http、ftp、rtsp、mms</span></span><br><span class="line">                + <span class="string">&quot;?(([0-9a-z_!~*&#x27;().&amp;=+$%-]+: )?[0-9a-z_!~*&#x27;().&amp;=+$%-]+@)?&quot;</span> <span class="comment">//ftp的user@</span></span><br><span class="line">                + <span class="string">&quot;(([0-9]&#123;1,3&#125;\\.)&#123;3&#125;[0-9]&#123;1,3&#125;&quot;</span> <span class="comment">// IP形式的URL- 例如：199.194.52.184</span></span><br><span class="line">                + <span class="string">&quot;|&quot;</span> <span class="comment">// 允许IP和DOMAIN（域名）</span></span><br><span class="line">                + <span class="string">&quot;([0-9a-z_!~*&#x27;()-]+\\.)*&quot;</span> <span class="comment">// 域名- www.</span></span><br><span class="line">                + <span class="string">&quot;([0-9a-z][0-9a-z-]&#123;0,61&#125;)?[0-9a-z]\\.&quot;</span> <span class="comment">// 二级域名</span></span><br><span class="line">                + <span class="string">&quot;[a-z]&#123;2,6&#125;)&quot;</span> <span class="comment">// first level domain- .com or .museum</span></span><br><span class="line">                + <span class="string">&quot;(:[0-9]&#123;1,5&#125;)?&quot;</span> <span class="comment">// 端口号最大为65535,5位数</span></span><br><span class="line">                + <span class="string">&quot;((/?)|&quot;</span> <span class="comment">// a slash isn&#x27;t required if there is no file name</span></span><br><span class="line">                + <span class="string">&quot;(/[0-9a-z_!~*&#x27;().;?:@&amp;=+$,%#-]+)+/?)$&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>  str.matches(regex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析出url参数中的键值对</span></span><br><span class="line">    <span class="comment">//如 &quot;index.jsp?Action=del&amp;id=123&quot;，解析出Action:del,id:123存入map中 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">URLRequest</span><span class="params">(String URL)</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; mapRequest = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">        String[] arrSplit = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strUrlParam</span> <span class="operator">=</span> TruncateUrlPage(URL);</span><br><span class="line">        <span class="keyword">if</span> (strUrlParam == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mapRequest;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//每一个键值为一组 www.2cto.com</span></span><br><span class="line">        arrSplit = strUrlParam.split(<span class="string">&quot;[&amp;]&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String strSplit : arrSplit) &#123;</span><br><span class="line">            String[] arrSplitEqual = <span class="literal">null</span>;</span><br><span class="line">            arrSplitEqual = strSplit.split(<span class="string">&quot;[=]&quot;</span>);</span><br><span class="line">            <span class="comment">//解析出键值</span></span><br><span class="line">            <span class="keyword">if</span> (arrSplitEqual.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">//正确解析</span></span><br><span class="line">                mapRequest.put(arrSplitEqual[<span class="number">0</span>], arrSplitEqual[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (arrSplitEqual[<span class="number">0</span>] != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                    <span class="comment">//只有参数没有值，不加入</span></span><br><span class="line">                    mapRequest.put(arrSplitEqual[<span class="number">0</span>], <span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mapRequest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//去掉url中的路径，留下请求参数部分 </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">TruncateUrlPage</span><span class="params">(String strURL)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strAllParam</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        String[] arrSplit = <span class="literal">null</span>;</span><br><span class="line">        strURL = strURL.trim();</span><br><span class="line">        arrSplit = strURL.split(<span class="string">&quot;[?]&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (strURL.length() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arrSplit.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (arrSplit[<span class="number">1</span>] != <span class="literal">null</span>) &#123;</span><br><span class="line">                    strAllParam = arrSplit[<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> strAllParam;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getIPAddress</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//X-Forwarded-For：Squid 服务代理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ipAddresses</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;X-Forwarded-For&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses == <span class="literal">null</span> || ipAddresses.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            <span class="comment">//Proxy-Client-IP：apache 服务代理</span></span><br><span class="line">            ipAddresses = request.getHeader(<span class="string">&quot;Proxy-Client-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses == <span class="literal">null</span> || ipAddresses.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            <span class="comment">//WL-Proxy-Client-IP：weblogic 服务代理</span></span><br><span class="line">            ipAddresses = request.getHeader(<span class="string">&quot;WL-Proxy-Client-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses == <span class="literal">null</span> || ipAddresses.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            <span class="comment">//HTTP_CLIENT_IP：有些代理服务器</span></span><br><span class="line">            ipAddresses = request.getHeader(<span class="string">&quot;HTTP_CLIENT_IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses == <span class="literal">null</span> || ipAddresses.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            <span class="comment">//X-Real-IP：nginx服务代理</span></span><br><span class="line">            ipAddresses = request.getHeader(<span class="string">&quot;X-Real-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//有些网络通过多层代理，那么获取到的ip就会有多个，一般都是通过逗号（,）分割开来，并且第一个ip为客户端的真实IP</span></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses != <span class="literal">null</span> &amp;&amp; ipAddresses.length() != <span class="number">0</span>) &#123;</span><br><span class="line">            ip = ipAddresses.split(<span class="string">&quot;,&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//还是不能获取到，最后再通过request.getRemoteAddr();获取</span></span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="literal">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            ip = request.getRemoteAddr();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ip;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OkHttp3工具类"><a href="#OkHttp3工具类" class="headerlink" title="OkHttp3工具类"></a>OkHttp3工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OkHttp3Utils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">OkHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">OkHttpClient</span> <span class="variable">httpsClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">OkHttpClient</span> <span class="variable">httpsClientW</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> Type.HTTP;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">        <span class="comment">//http, https, https 绕过</span></span><br><span class="line">        HTTP, HTTPS, HTTPSW;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">get</span><span class="params">(<span class="keyword">final</span> String url)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> commonRequest(url, Request.Builder::get);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// application/x-www-form-urlencoded</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8from</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> Map&lt;String, String&gt; parameters)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> post8from(url, formBody -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (parameters == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessError</span>(<span class="string">&quot;parameters is null!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(Map.Entry&lt;String, String&gt; entry : parameters.entrySet()) &#123;</span><br><span class="line">                    formBody.add(entry.getKey(), entry.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// application/x-www-form-urlencoded</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8from</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> String... values)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> post8from(url, formBody -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (values != <span class="literal">null</span> &amp;&amp; values.length &gt; <span class="number">2</span> &amp;&amp; values.length%<span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; values.length;) &#123;</span><br><span class="line">                    formBody.add(values[index++], values[index++]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// application/x-www-form-urlencoded</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8from</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> Consumer&lt;FormBody.Builder&gt; consumer)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        FormBody.<span class="type">Builder</span> <span class="variable">formBody</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormBody</span>.Builder();</span><br><span class="line">        consumer.accept(formBody);</span><br><span class="line">        <span class="type">RequestBody</span> <span class="variable">requestBody</span> <span class="operator">=</span> formBody.build();</span><br><span class="line">        <span class="keyword">return</span> commonRequest(url, builder -&gt; builder.post(requestBody));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// application/json</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8json</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> Object jsonObject)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (jsonObject == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessError</span>(<span class="string">&quot;jsonObject is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> post8json(url, JSONObject.toJSONString(jsonObject));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// application/json</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8json</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> String json)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (json == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessError</span>(<span class="string">&quot;json is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">RequestBody</span> <span class="variable">body</span> <span class="operator">=</span> RequestBody.create(MediaType.parse(<span class="string">&quot;application/json; charset=utf-8&quot;</span>), json);</span><br><span class="line">        <span class="keyword">return</span> commonRequest(url, builder -&gt; builder.post(body));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// application/json</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8json</span><span class="params">(<span class="keyword">final</span> Consumer&lt;Request.Builder&gt; header, <span class="keyword">final</span> String url, <span class="keyword">final</span> String json)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (json == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessError</span>(<span class="string">&quot;json is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">RequestBody</span> <span class="variable">body</span> <span class="operator">=</span> RequestBody.create(MediaType.parse(<span class="string">&quot;application/json; charset=utf-8&quot;</span>), json);</span><br><span class="line">        <span class="keyword">return</span> commonRequest(url, builder -&gt; &#123;</span><br><span class="line">                header.accept(builder);</span><br><span class="line">                builder.post(body);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">checkHttpUrl</span><span class="params">(<span class="keyword">final</span> String url)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO 汉子处理</span></span><br><span class="line">        <span class="comment">/*if (url == null || !UrlUtils.isURL(url)) &#123;</span></span><br><span class="line"><span class="comment">            throw new IllegalArgumentException(&quot;Http 请求 Url 错误: &quot; + url);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">commonRequest</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> Consumer&lt;Request.Builder&gt; consumer)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Request.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder().url(checkHttpUrl(url));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 请求做成</span></span><br><span class="line">        consumer.accept(builder);</span><br><span class="line">        <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> builder.build();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Call</span> <span class="variable">call</span> <span class="operator">=</span> getHttpClient().newCall(request);</span><br><span class="line">        <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> call.execute();</span><br><span class="line">        <span class="keyword">return</span> Objects.requireNonNull(response.body()).string();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> String <span class="title function_">executeHttpRequest</span><span class="params">(Supplier&lt;String&gt; http, Type type)</span> &#123;</span><br><span class="line">        String result;</span><br><span class="line">        OkHttp3Utils.type = type;</span><br><span class="line">        result = http.get();</span><br><span class="line">        OkHttp3Utils.type = Type.HTTP;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> OkHttpClient <span class="title function_">getHttpClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">OkHttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> HTTP:</span><br><span class="line">                <span class="keyword">if</span> (httpClient == <span class="literal">null</span>) &#123;</span><br><span class="line">                    httpClient = <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.Builder()</span><br><span class="line">                            <span class="comment">// 设置连接超时时间</span></span><br><span class="line">                            .connectTimeout(<span class="number">60</span>, TimeUnit.SECONDS)</span><br><span class="line">                            <span class="comment">//设置读取超时时间</span></span><br><span class="line">                            .readTimeout(<span class="number">60</span>, TimeUnit.SECONDS)</span><br><span class="line">                            .build();</span><br><span class="line">                &#125;</span><br><span class="line">                client = httpClient;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> HTTPS:</span><br><span class="line">                <span class="comment">// 暂时不用</span></span><br><span class="line">            <span class="keyword">case</span> HTTPSW:</span><br><span class="line">                <span class="keyword">if</span> (httpsClientW == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">X509TrustManager</span> <span class="variable">manager</span> <span class="operator">=</span> SSLSocketClient.getX509TrustManager();</span><br><span class="line">                    OkHttpClient.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.Builder();</span><br><span class="line">                    builder.sslSocketFactory(SSLSocketClient.getSocketFactory(manager), manager);</span><br><span class="line">                    builder.hostnameVerifier(SSLSocketClient.getHostnameVerifier());</span><br><span class="line">                    httpsClientW = builder</span><br><span class="line">                            <span class="comment">// 设置连接超时时间</span></span><br><span class="line">                            .connectTimeout(<span class="number">60</span>, TimeUnit.SECONDS)</span><br><span class="line">                            <span class="comment">//设置读取超时时间</span></span><br><span class="line">                            .readTimeout(<span class="number">60</span>, TimeUnit.SECONDS)</span><br><span class="line">                            .build();</span><br><span class="line">                &#125;</span><br><span class="line">                client = httpsClientW;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// nothing do to.</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 重置</span></span><br><span class="line">        type = Type.HTTP;</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SSLSocketClinet"><a href="#SSLSocketClinet" class="headerlink" title="SSLSocketClinet"></a>SSLSocketClinet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ssl 绕过</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSLSocketClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SSLSocketFactory <span class="title function_">getSocketFactory</span><span class="params">(TrustManager manager)</span> &#123;</span><br><span class="line">        <span class="type">SSLSocketFactory</span> <span class="variable">socketFactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SSLContext</span> <span class="variable">sslContext</span> <span class="operator">=</span> SSLContext.getInstance(<span class="string">&quot;SSL&quot;</span>);</span><br><span class="line">            sslContext.init(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">TrustManager</span>[]&#123;manager&#125;, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">            socketFactory = sslContext.getSocketFactory();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> socketFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> X509TrustManager <span class="title function_">getX509TrustManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">X509TrustManager</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">X509Certificate</span>[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HostnameVerifier <span class="title function_">getHostnameVerifier</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HostnameVerifier</span> <span class="variable">hostnameVerifier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HostnameVerifier</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(String s, SSLSession sslSession)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> hostnameVerifier;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AOP工具类"><a href="#AOP工具类" class="headerlink" title="AOP工具类"></a>AOP工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UtilityClass</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getClassName</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> joinPoint.getTarget().getClass().getName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getSimpleClassName</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> getClassName(joinPoint);</span><br><span class="line">        <span class="keyword">return</span> className.substring(className.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getMethodName</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> joinPoint.getSignature().getName();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//获取切面的参数json</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getArgsJsonString</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">argsJson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="keyword">for</span> (Object arg : args) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isFilterObject(arg)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ObjectUtil.isNotNull(arg)) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">jsonStr</span> <span class="operator">=</span> JSON.toJSONString(arg);</span><br><span class="line">                    argsJson.append(jsonStr).append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> argsJson.toString().trim();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//判断是否需要拼接参数，过滤掉HttpServletRequest,MultipartFile,HttpServletResponse等类型参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isFilterObject</span><span class="params">(Object arg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> arg <span class="keyword">instanceof</span> MultipartFile || arg <span class="keyword">instanceof</span> HttpServletRequest || arg <span class="keyword">instanceof</span> HttpServletResponse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文档生成"><a href="#文档生成" class="headerlink" title="文档生成"></a>文档生成</h2><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><h3 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h3><ol>
<li>需要将各个模块分别部署，所有模块需要在同一级目录下<ul>
<li>mysql需要打包配置和数据</li>
</ul>
</li>
<li>编写对应的 DockerFile 文件</li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一阶段</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span> as builder</span><br><span class="line"><span class="comment"># 工作目录为/build 相对目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /build</span></span><br><span class="line"><span class="comment"># 设置常量</span></span><br><span class="line"><span class="keyword">ARG</span> JAR_FILE=./模块名.jar</span><br><span class="line"><span class="comment"># 拷贝target/模块名.jar  到/build/app.jar</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> <span class="variable">$&#123;JAR_FILE&#125;</span> app.jar</span></span><br><span class="line"><span class="comment"># 执行shell命令 使用分层 这里就是解压jar包分层成各个目录  目的是为了更新的时候局部更新 加快镜像pull速度</span></span><br><span class="line"><span class="comment"># /build/dependencies</span></span><br><span class="line"><span class="comment"># /build/snapshot-dependencies</span></span><br><span class="line"><span class="comment"># /build/spring-boot-loader</span></span><br><span class="line"><span class="comment"># /build/application</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> java -Djarmode=layertools -jar app.jar extract &amp;&amp; <span class="built_in">rm</span> app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二阶段 引用第一阶段的镜像builder</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> <span class="number">569421432</span>@qq.com</span><br><span class="line"><span class="keyword">ENV</span> JAVA_OPTS=<span class="string">&quot;-Xms1024m -Xmx1024m -Duser.timezone=GMT+8 -DNACOS_HOST=10.1.3.160 -Djava.security.egd=file:/dev/./urandom&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_EX=<span class="string">&quot;-DMYSQL_HOST=192.168.8.91 -DMYSQL_PORT=3306 -DMYSQL_PWD=hj@123456 -DMYSQL_DB=bling -DREDIS_HOST=192.168.8.91 -DREDIS_PWD=hj@123456 -Dspring.profiles.active=test&quot;</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /opt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将builder（第一阶段）的文件copy到/opt</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /build/dependencies/ ./</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /build/snapshot-dependencies/ ./</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /build/spring-boot-loader/ ./</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /build/application/ ./</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 容器启动时执行</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> java <span class="variable">$JAVA_OPTS</span> <span class="variable">$JAVA_EX</span> org.springframework.boot.loader.JarLauncher</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写一个方便重新启动的文件 <code>restart.sh</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ &quot;$1&quot; = &#x27;&#x27; ]; then</span><br><span class="line">    echo &quot;You need to enter a project name!&quot;</span><br><span class="line">else</span><br><span class="line">    docker-compose stop $1</span><br><span class="line">    docker-compose rm -f $1</span><br><span class="line">    docker-compose build $1</span><br><span class="line">    docker-compose up -d $1</span><br><span class="line">    echo &quot;ok !!!&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启动：<code>./restart.sh 模块名</code></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/" data-id="clrj8pzxv008f6wuw0lgp8hfo" data-title="框架设计" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Note/后端/Java/开发/规范" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E8%A7%84%E8%8C%83/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.691Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E8%A7%84%E8%8C%83/">代码规范</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><table>
<thead>
<tr>
<th>值</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>DTO</td>
<td>接口入参，即前端传给后端的Json接收对象</td>
</tr>
<tr>
<td>VO</td>
<td>接口返回对象，即后端传给前端展示数据用的对象</td>
</tr>
<tr>
<td>PO</td>
<td>数据库表对应的对象，和Entity等同</td>
</tr>
<tr>
<td>BO</td>
<td>业务对象，即一组PO，例如员工信息，包括了（基础，入职、离职等等）</td>
</tr>
<tr>
<td>DAO</td>
<td>数据访问对象，操作数据库的对象</td>
</tr>
</tbody></table>
<h2 id="LomboK"><a href="#LomboK" class="headerlink" title="LomboK"></a>LomboK</h2><ul>
<li>避免使用@Data注解，使用@Getter、@Setter、@ToString替代</li>
<li>尽量自己实现 hashCode 和 equals 方法</li>
<li>在使用 Lombok 的情况下<ul>
<li>boolean类型的变量不能以 is 开头</li>
<li>字段名前两个字母最好为小写，非要有大写的话使用 @TableField 注解指定字段，或者专门为其写 get 和 set 方法</li>
</ul>
</li>
</ul>
<h2 id="返回值处理"><a href="#返回值处理" class="headerlink" title="返回值处理"></a>返回值处理</h2><ul>
<li>如果返回的集合没有数据的话就返回空集合，不要返回null</li>
</ul>
<h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><ul>
<li>使用构造注入替代@Autowired注入Bean对象<ul>
<li>好处<ul>
<li>能够在项目启动时检测出出现循环依赖的模块</li>
<li>可以使用final关键字来修饰依赖字段使其不可变</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="事务规范"><a href="#事务规范" class="headerlink" title="事务规范"></a>事务规范</h2><ul>
<li>如果事务方法中涉及远程网络调用的情况的话，不要使用spring的事务来控制<ul>
<li>因为如果远程网络调用时间过长，事务占用时间就长，占用数据库资源的时间也长，可能会导致数据库连接不够用</li>
</ul>
</li>
</ul>
<h2 id="数据库规范"><a href="#数据库规范" class="headerlink" title="数据库规范"></a>数据库规范</h2><ul>
<li>如果创建的表在后续可能会新增字段，就在创建表时添加一些扩展字段</li>
<li>尽量不要创建外建约束</li>
<li>可以通过第三张表来表示两张表的关联关系</li>
</ul>
<h2 id="SQL规范"><a href="#SQL规范" class="headerlink" title="SQL规范"></a>SQL规范</h2><ul>
<li><p>使用sum函数时如果可能出现为0的情况，需要使用 IFNULL(SUM(), 0) 约束</p>
</li>
<li><p>用String类型接收返回值时要注意null的问题，有可能返回 null 字符串的</p>
</li>
<li><p>尽量不要在已经线上正常运行的sql上加东西，最好再写一个sql</p>
</li>
<li><p>固定长度的字段选择char，不定的才选varchar</p>
<ul>
<li>char速度快，varchar节省空间</li>
</ul>
</li>
<li><p>大文本字段使用text或longtext，最好用另外一张表存储</p>
</li>
<li><p>存储图片用blob或longblob</p>
</li>
<li><p>金额使用decimal</p>
</li>
<li><p>设置字段默认值，约束</p>
</li>
</ul>
<h2 id="业务规范"><a href="#业务规范" class="headerlink" title="业务规范"></a>业务规范</h2><h3 id="当接口出现bug时"><a href="#当接口出现bug时" class="headerlink" title="当接口出现bug时"></a>当接口出现bug时</h3><ul>
<li>应该先查询有多少个地方使用了该接口<ul>
<li>如果只有一处使用则可以进行修改</li>
<li>如果多出使用必须仔细排查和列出修改后可能出现的情况<ul>
<li>xml可能存在复用的情况</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="项目上线后，当发现代码有错误或者冗余时，尽量不要修改"><a href="#项目上线后，当发现代码有错误或者冗余时，尽量不要修改" class="headerlink" title="项目上线后，当发现代码有错误或者冗余时，尽量不要修改"></a>项目上线后，当发现代码有错误或者冗余时，尽量不要修改</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E8%A7%84%E8%8C%83/" data-id="clrj8pzxw008j6wuw3dsn2c4o" data-title="代码规范" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8A%80%E5%B7%A7/" rel="tag">技巧</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%A7%84%E8%8C%83/" rel="tag">规范</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Note/后端/Java/开发/常见问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.690Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/">常见开发问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="找不到resource下的文件"><a href="#找不到resource下的文件" class="headerlink" title="找不到resource下的文件"></a>找不到resource下的文件</h2><ul>
<li>在pom下加</li>
</ul>
<p><img src="/../../pic/image-20220114232916497.png" alt="image-20220114232916497"></p>
<h2 id="本地运行正常，打jar包后运行不了，包重复resultmap问题"><a href="#本地运行正常，打jar包后运行不了，包重复resultmap问题" class="headerlink" title="本地运行正常，打jar包后运行不了，包重复resultmap问题"></a>本地运行正常，打jar包后运行不了，包重复resultmap问题</h2><ul>
<li>常见于资源、lib、代码分开打包的项目，资源中的mapper和resource中的mapper重复导致的</li>
</ul>
<h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><ul>
<li><p>因为浏览器不能执行其他网站的脚本，它是由浏览器的同源策略导致的，是浏览器对js的安全限制</p>
<ul>
<li>协议、域名、端口都要相同，一个不同即发生跨域</li>
</ul>
</li>
<li><p>非简单请求需要先发送一个预检请求，服务器响应允许跨域后才能发送真实请求</p>
<ul>
<li>post请求</li>
</ul>
</li>
<li><p>解决方案</p>
<ol>
<li><p>使用nginx</p>
<ul>
<li><p>nginx会和其他服务在同一个域，所以不会出现跨域问题</p>
</li>
<li><p>前提是前端项目、网关、后端服务等需要在一个域</p>
</li>
</ul>
</li>
<li><p>配置当前请求允许跨域，添加响应头</p>
<ol>
<li>可以在gateway的配置文件中添加全局过滤器</li>
<li>也可以编写配置类</li>
</ol>
</li>
</ol>
</li>
</ul>
<h2 id="非spring模块下的类加入spring容器"><a href="#非spring模块下的类加入spring容器" class="headerlink" title="非spring模块下的类加入spring容器"></a>非spring模块下的类加入spring容器</h2><ul>
<li><p>例如将全局异常处理写在了common包下，但是common包不属于spring管理的包，所以不起作用的情况</p>
</li>
<li><p>解决方法</p>
<ol>
<li><p>在非spring模块的包里创建一个类，将需要加入容器的类通过@Import导入这个类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(value = &#123;</span></span><br><span class="line"><span class="meta">        GlobalExceptionHandler.class</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebExtendConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在resource下创建META-INF文件夹，文件夹下创建 spring.factories</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">//加入</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">com.xz.market.common.web.WebExtendConfiguration</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="redis集群ip问题"><a href="#redis集群ip问题" class="headerlink" title="redis集群ip问题"></a>redis集群ip问题</h2><ul>
<li><p>docker生成的主机ip地址，无法搭建集群</p>
</li>
<li><p>容器的ip地址，可以搭建集群，但是集群在客户端不可用，服务端可用</p>
</li>
<li><p>主机的ip地址，无法搭建集群</p>
</li>
<li><p>解决方案：</p>
<ul>
<li><p>创建容器的时候指定网络类型为host</p>
</li>
<li><p>弊端：不安全，容器ip地址暴露</p>
</li>
</ul>
</li>
</ul>
<h2 id="Netty冲突"><a href="#Netty冲突" class="headerlink" title="Netty冲突"></a>Netty冲突</h2><ul>
<li>Redis中使用到了netty，elasticSearch中也引入了netty，发生冲突</li>
<li>需要在启动类中添加<ul>
<li><code>System.setProperty(&quot;es.set.netty.runtime.available.processors&quot;, &quot;false&quot;)</code></li>
</ul>
</li>
</ul>
<h2 id="打包版本问题"><a href="#打包版本问题" class="headerlink" title="打包版本问题"></a>打包版本问题</h2><ul>
<li>打包的maven插件需要指定版本，与sprigboot版本一致</li>
</ul>
<h2 id="非法访问异常"><a href="#非法访问异常" class="headerlink" title="非法访问异常"></a>非法访问异常</h2><ul>
<li>Jdk &gt; 1.8   虚拟机加参数<ul>
<li><code>--add-opens java.base/java.lang=ALL-UNNAMED</code></li>
</ul>
</li>
</ul>
<h2 id="spring-security获取不到Authentication"><a href="#spring-security获取不到Authentication" class="headerlink" title="spring-security获取不到Authentication"></a>spring-security获取不到Authentication</h2><ul>
<li><p>异常信息</p>
<ul>
<li><strong>For input string: “ANONYMOUS”</strong> 的错误</li>
</ul>
</li>
<li><p>可能原因</p>
<ul>
<li>没有获取到登录的用户导致的获取不到用户信息</li>
</ul>
</li>
<li><p>解决方法</p>
<ul>
<li>修改鉴权配置</li>
<li>排查代码问题</li>
</ul>
</li>
</ul>
<h2 id="There-is-no-PasswordEncoder-mapped-for-the-id-“null”"><a href="#There-is-no-PasswordEncoder-mapped-for-the-id-“null”" class="headerlink" title="There is no PasswordEncoder mapped for the id “null”"></a>There is no PasswordEncoder mapped for the id “null”</h2><ul>
<li>这个错主要发生在Spring-Sercurity5.X版本上，例如SpringBoot2.x。导致这个错误发生主要原因就是在之前版本中的<strong>NoOpPasswordEncoder</strong>被<strong>DelegatingPasswordEncoder</strong>取代了，而你保存在数据库中的密码没有没有指定加密方式。</li>
<li>使用DelegatingPasswordEncoder解决</li>
</ul>
<h2 id="数据库字段采用一个字母加下划线开头"><a href="#数据库字段采用一个字母加下划线开头" class="headerlink" title="数据库字段采用一个字母加下划线开头"></a>数据库字段采用一个字母加下划线开头</h2><ul>
<li>数据库字段例如：c_type</li>
<li>然后pojo类如果是：cType</li>
<li>会导致前端传参的时候取不到值</li>
<li>解决方法：<ul>
<li>pojo改为 ctype 然后用@TableField(“c_type”)，前端传 ctype</li>
</ul>
</li>
</ul>
<h2 id="写XML的SQL如果有del-flag要记得写上"><a href="#写XML的SQL如果有del-flag要记得写上" class="headerlink" title="写XML的SQL如果有del_flag要记得写上"></a>写XML的SQL如果有del_flag要记得写上</h2><h2 id="注入Service失败"><a href="#注入Service失败" class="headerlink" title="注入Service失败"></a>注入Service失败</h2><ul>
<li><p>方法一：使用静态变量 加 @PostConstruct 解决。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//关键1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticlesReceiver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span>  WechatArticlesTempService wechatArticlesTempService;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ArticlesReceiver articlesReceiver; <span class="comment">//关键2</span></span><br><span class="line">     </span><br><span class="line">    <span class="meta">@PostConstruct</span> <span class="comment">//关键3</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    　　　　articlesReceiver = <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">         </span><br><span class="line">    <span class="keyword">public</span> WechatArticlesTemp <span class="title function_">getResposeArticlesBoby</span><span class="params">(String mediaId)</span> &#123;</span><br><span class="line">        <span class="type">WechatArticlesTemp</span> <span class="variable">articlesTemp</span> <span class="operator">=</span> articlesReceiver.wechatArticlesTempService.getById(mediaId); <span class="comment">//关键4</span></span><br><span class="line">　　　　　　　　　　<span class="keyword">return</span> articlesTemp ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：使用静态变量，加set注入　</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//关键1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticlesReceiver</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> WechatArticlesTempService wechatArticlesTempService; <span class="comment">//关键2</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//关键3</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWechatArticlesTempService</span> <span class="params">(WechatArticlesTempService wechatArticlesTempService)</span>&#123;</span><br><span class="line">        ArticlesReceiver.wechatArticlesTempService = wechatArticlesTempService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> WechatArticlesTemp <span class="title function_">getResposeArticlesBoby</span><span class="params">(String mediaId)</span> &#123;</span><br><span class="line">        <span class="type">WechatArticlesTemp</span> <span class="variable">articlesTemp</span> <span class="operator">=</span> wechatArticlesTempService.getById(mediaId); <span class="comment">//关键4</span></span><br><span class="line">        <span class="keyword">return</span> articlesTemp ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法三：代码注入 ， SpringContectHolder类将用到的类的class读入让后再调用类中方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//关键1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticlesReceiver</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">WechatArticlesTempService</span> <span class="variable">wechatArticlesTempService</span> <span class="operator">=</span>  SpringContextHolder.getBean(WechatArticlesTempService.class); <span class="comment">//关键2</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> WechatArticlesTemp <span class="title function_">getResposeArticlesBoby</span><span class="params">(String mediaId)</span> &#123;</span><br><span class="line">　　　　　　　　　　<span class="type">WechatArticlesTemp</span> <span class="variable">articlesTemp</span> <span class="operator">=</span> wechatArticlesTempService.getById(mediaId); <span class="comment">//关键3</span></span><br><span class="line">　　　　　　　　　　<span class="keyword">return</span> articlesTemp ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="导入的接口如果添加了日志注解可能会报错，但是接口能正常通过"><a href="#导入的接口如果添加了日志注解可能会报错，但是接口能正常通过" class="headerlink" title="导入的接口如果添加了日志注解可能会报错，但是接口能正常通过"></a>导入的接口如果添加了日志注解可能会报错，但是接口能正常通过</h2><ul>
<li>解决方法<ul>
<li>删除日志注解</li>
</ul>
</li>
</ul>
<h2 id="序列化异常"><a href="#序列化异常" class="headerlink" title="序列化异常"></a>序列化异常</h2><ul>
<li>可能的原因<ul>
<li>redis缓存问题</li>
</ul>
</li>
<li>解决方法<ul>
<li>清理redis缓存</li>
</ul>
</li>
</ul>
<h2 id="Request流只能读取一次"><a href="#Request流只能读取一次" class="headerlink" title="Request流只能读取一次"></a>Request流只能读取一次</h2><ul>
<li><p>包装Request解决</p>
</li>
<li><p>通过过滤器进行包装request对象</p>
<ul>
<li>用instanceof 判断是否包装过</li>
</ul>
</li>
<li><p>创建<code>MyServletRequestWrapper</code> 继承 <code>HttpServletRequestWrapper</code> </p>
</li>
<li><p>通过过滤器包装request</p>
</li>
</ul>
<h2 id="创建数据失败，重启服务后又能成功创建"><a href="#创建数据失败，重启服务后又能成功创建" class="headerlink" title="创建数据失败，重启服务后又能成功创建"></a>创建数据失败，重启服务后又能成功创建</h2><ul>
<li>可能的原因<ul>
<li>Redis自增生成的分布式ID返回了null值<ul>
<li>推测1：有一段时间内执行了大量的任务，Redis连接未释放</li>
<li>推测2：spring事务中使用increment会返回null</li>
<li>推测3：同时开启spring事务和redis事务导致的（实际原因）<ul>
<li>业务代码执行自增操作会返回null，但是redis中的值是会自增的</li>
<li>开启redis事务后，在spring事务中执行的redis命令也会被认为是在redis中执行的，所以不会立即返回结果，所以返回了null值</li>
<li>源码中是有一个Muti方法标记了redis事务块的开始</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>解决方案<ul>
<li>redis事务操作完成后，关闭redis事务，然后再执行spring事务中的redis代码<ul>
<li>多线程下可能还是会出现问题</li>
</ul>
</li>
<li>创建两个StringRedisTemplate，一个专门用来执行redis事务，一个用来执行spring相关命令</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" data-id="clrj8pzxu00856wuw0cgi6146" data-title="常见开发问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%97%AE%E9%A2%98/" rel="tag">问题</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Note/后端/Java/开发/技巧" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E6%8A%80%E5%B7%A7/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.690Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E6%8A%80%E5%B7%A7/">开发技巧</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="开发技巧"><a href="#开发技巧" class="headerlink" title="开发技巧"></a>开发技巧</h1><h2 id="一对多表修改"><a href="#一对多表修改" class="headerlink" title="一对多表修改"></a>一对多表修改</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  修改信息通用方法</span></span><br><span class="line"><span class="comment">*  exists 数据库存在的记录</span></span><br><span class="line"><span class="comment">*  params 修改时传的记录</span></span><br><span class="line"><span class="comment">*  T 是实体pojo</span></span><br><span class="line"><span class="comment">*  S 是对应的service对象，需要继承 IService</span></span><br><span class="line"><span class="comment">*  id 是主表的id</span></span><br><span class="line"><span class="comment">*  key 存id，value存记录</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> &lt;T, S <span class="keyword">extends</span> <span class="title class_">IService</span>&gt; Boolean <span class="title function_">updateCom</span><span class="params">(HashMap&lt;String, T&gt; exists, HashMap&lt;String, T&gt; params, S s, Long id)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, T&gt; entry : params.entrySet()) &#123;</span><br><span class="line">        <span class="comment">//修改</span></span><br><span class="line">        <span class="keyword">if</span> (exists.containsKey(entry.getKey())) &#123;</span><br><span class="line">            s.update(entry.getValue(), <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;T&gt;().eq(<span class="string">&quot;id&quot;</span>, entry.getKey()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//增加</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;null&quot;</span>.equals(entry.getKey())) &#123;</span><br><span class="line">            <span class="type">T</span> <span class="variable">value</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">            BeanUtil.setFieldValue(value, <span class="string">&quot;uid&quot;</span>, id);</span><br><span class="line">            s.save(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, T&gt; entry : exists.entrySet()) &#123;</span><br><span class="line">        <span class="comment">//删除</span></span><br><span class="line">        <span class="keyword">if</span> (!params.containsKey(entry.getKey())) &#123;</span><br><span class="line">            s.remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;T&gt;().eq(<span class="string">&quot;id&quot;</span>, entry.getKey()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    exists.clear();</span><br><span class="line">    params.clear();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="条件判断中in中for循环"><a href="#条件判断中in中for循环" class="headerlink" title="条件判断中in中for循环"></a>条件判断中in中for循环</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">if</span> test=<span class="string">&quot;clxz!=null and clxz!=&#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">    and t2.CLXZ in</span><br><span class="line">    &lt;foreach collection=<span class="string">&quot;clxz.split(&#x27;,&#x27;)&quot;</span> index=<span class="string">&quot;index&quot;</span> item=<span class="string">&quot;item&quot;</span> open=<span class="string">&quot;(&quot;</span> close=<span class="string">&quot;)&quot;</span> separator=<span class="string">&quot;,&quot;</span>&gt;</span><br><span class="line">    #&#123;item&#125;</span><br><span class="line">	&lt;/foreach&gt;</span><br><span class="line">&lt;/<span class="keyword">if</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="使用MD5对第三方api接口进行签名验签"><a href="#使用MD5对第三方api接口进行签名验签" class="headerlink" title="使用MD5对第三方api接口进行签名验签"></a>使用MD5对第三方api接口进行签名验签</h2><ul>
<li>确保我们提供给第三方的api接口数据不会被抓包后篡改数据或进行重放攻击</li>
<li>前后端规定好一个sign，调用接口时需要传MD5加密过的数据</li>
<li>然后后端根据入参凭借规定好的sign加密数据，然后比对前端传进来的加密数据是否一致</li>
<li>还需要设置超时逻辑，允许一段时间内前端向后端发起的请求</li>
</ul>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ul>
<li>拦截器实现<ul>
<li>远程调用本地模块中的一些数据</li>
<li>拦截需要给提示信息</li>
<li>拦截器中需要使用到容器中的bean，一般是会出现空指针异常的<ul>
<li>在拦截器配置类中使用@Bean注册拦截器类即可</li>
</ul>
</li>
<li>请求拦截后无任何提示信息，空白页面不友好</li>
</ul>
<p>　</p>
</li>
<li>AOP实现</li>
</ul>
<h2 id="比较两个集合对象的异同"><a href="#比较两个集合对象的异同" class="headerlink" title="比较两个集合对象的异同"></a>比较两个集合对象的异同</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C.stream().filter(c -&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> I.stream().filter(i -&gt; i.getname() == c.getname()).count() &gt; <span class="number">0</span>;</span><br><span class="line">&#125;).collect(Collectors.toList()).forEach(hjUserContactMapper::insert);</span><br></pre></td></tr></table></figure>

<ul>
<li>大于0则相同，小于等于0不同</li>
</ul>
<h2 id="各项求比例后和为100"><a href="#各项求比例后和为100" class="headerlink" title="各项求比例后和为100%"></a>各项求比例后和为100%</h2><h4 id="最大余额法"><a href="#最大余额法" class="headerlink" title="最大余额法"></a>最大余额法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 最大余额法 求百分比</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">calculatePercent</span><span class="params">(List&lt;Long&gt; list)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">sum</span> <span class="operator">=</span> list.stream().reduce(Long::sum).get();</span><br><span class="line">    List&lt;Integer&gt; valueInts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Double&gt; ds = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Long percent : list) &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">value</span> <span class="operator">=</span> percent * <span class="number">100</span> / (<span class="type">double</span>) sum;</span><br><span class="line">        <span class="comment">//设置对应的百分比</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">valueInt</span> <span class="operator">=</span> (<span class="type">int</span>) value;</span><br><span class="line">        valueInts.add(valueInt);</span><br><span class="line">        <span class="comment">//获取小数点后的值</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> value - valueInt;</span><br><span class="line">        ds.add(d);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//求和：当前各项百分比合计。由于我们舍弃了小数位，所以该合计只会小于等于100</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">curSum</span> <span class="operator">=</span> valueInts.stream().mapToInt(e -&gt; e).sum();</span><br><span class="line">    <span class="keyword">while</span> (curSum &lt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="comment">//找出小数余额最大的组，对其进行加1</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">max</span> <span class="operator">=</span> valueInts.stream().max(Comparator.comparingDouble(e -&gt; ds.get(valueInts.indexOf(e))</span><br><span class="line">                                                                       )).get();</span><br><span class="line">        valueInts.set(valueInts.indexOf(max), max + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//当前这个数已经加1了，不应该参与下一轮的竞选</span></span><br><span class="line">        ds.set(valueInts.indexOf(max + <span class="number">1</span>), <span class="number">0.0</span>);</span><br><span class="line">        curSum++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> valueInts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建Map时添加值"><a href="#创建Map时添加值" class="headerlink" title="创建Map时添加值"></a>创建Map时添加值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;K, V&gt;()&#123;</span><br><span class="line">    &#123;</span><br><span class="line">        put(key, value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Stream流"><a href="#Stream流" class="headerlink" title="Stream流"></a>Stream流</h2><h3 id="取对象列表中日期最大值最小值"><a href="#取对象列表中日期最大值最小值" class="headerlink" title="取对象列表中日期最大值最小值"></a>取对象列表中日期最大值最小值</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m.getValue().stream().min(Comparator.comparing(HjUserWorkHourDTO::getWorkDate)).get().getWorkDate();</span><br><span class="line">m.getValue().stream().max(Comparator.comparing(HjUserWorkHourDTO::getWorkDate)).get().getWorkDate();</span><br></pre></td></tr></table></figure>

<h1 id="运维技巧"><a href="#运维技巧" class="headerlink" title="运维技巧"></a>运维技巧</h1><h1 id="SQL技巧"><a href="#SQL技巧" class="headerlink" title="SQL技巧"></a>SQL技巧</h1><h3 id="截取身份证年月日"><a href="#截取身份证年月日" class="headerlink" title="截取身份证年月日"></a>截取身份证年月日</h3><p><code>DATE_FORMAT(cast(substring(&#39;44050919990409401X&#39;, 7, 8) as date), &#39;%Y-%m-%d&#39;)</code></p>
<h3 id="通过身份证计算年龄"><a href="#通过身份证计算年龄" class="headerlink" title="通过身份证计算年龄"></a>通过身份证计算年龄</h3><p><code>YEAR(NOW())- SUBSTRING(hui.uid_code,7,4)</code> </p>
<h3 id="xml返回Map"><a href="#xml返回Map" class="headerlink" title="xml返回Map"></a>xml返回Map</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapKey(&quot;deptId&quot;)</span></span><br><span class="line">HashMap&lt;Long, List&lt;HjUserInfoDTO&gt;&gt; <span class="title function_">getDeptAndUser</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;deptAndUser&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.util.Map&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;deptId&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;users&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.util.ArrayList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.bda.huijun.hr.personnel.entity.vo.HjUserInfoVO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ID&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;UID_TYPE&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uidType&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndUser&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;deptAndUser&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="判断是否存在参数"><a href="#判断是否存在参数" class="headerlink" title="判断是否存在参数"></a>判断是否存在参数</h3><ul>
<li><code>_parmeter.containKey()</code></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E6%8A%80%E5%B7%A7/" data-id="clrj8pzxv00886wuw7v9k47cg" data-title="开发技巧" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8A%80%E5%B7%A7/" rel="tag">技巧</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Note/后端/Java/开发/工具" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E5%B7%A5%E5%85%B7/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.689Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E5%B7%A5%E5%85%B7/">工具</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="EasyExcel"><a href="#EasyExcel" class="headerlink" title="EasyExcel"></a>EasyExcel</h1><ul>
<li>可以使用pig4封装过后的EasyExcel，提供了注解式的使用导入导出，比较方便</li>
</ul>
<h2 id="下拉框"><a href="#下拉框" class="headerlink" title="下拉框"></a>下拉框</h2><p>service层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">template</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;人员导入模板.xls&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">WriteCellStyle</span> <span class="variable">headWriteCellStyle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteCellStyle</span>();</span><br><span class="line">    <span class="comment">// 设置背景颜色</span></span><br><span class="line">    headWriteCellStyle.setFillForegroundColor(IndexedColors.WHITE.getIndex());</span><br><span class="line">    <span class="comment">// 设置头字体</span></span><br><span class="line">    <span class="type">WriteFont</span> <span class="variable">headWriteFont</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteFont</span>();</span><br><span class="line">    headWriteFont.setFontHeightInPoints((<span class="type">short</span>)<span class="number">14</span>);</span><br><span class="line">    <span class="comment">// 字体加粗</span></span><br><span class="line">    headWriteFont.setBold(<span class="literal">true</span>);</span><br><span class="line">    headWriteCellStyle.setWriteFont(headWriteFont);</span><br><span class="line">    <span class="comment">// 设置头居中</span></span><br><span class="line">    headWriteCellStyle.setHorizontalAlignment(HorizontalAlignment.CENTER);</span><br><span class="line">    <span class="comment">// 内容策略</span></span><br><span class="line">    <span class="type">WriteCellStyle</span> <span class="variable">contentWriteCellStyle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteCellStyle</span>();</span><br><span class="line">    <span class="comment">// 设置内容字体</span></span><br><span class="line">    <span class="type">WriteFont</span> <span class="variable">contentWriteFont</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteFont</span>();</span><br><span class="line">    contentWriteFont.setFontHeightInPoints((<span class="type">short</span>)<span class="number">12</span>);</span><br><span class="line">    contentWriteFont.setFontName(<span class="string">&quot;宋体&quot;</span>);</span><br><span class="line">    contentWriteCellStyle.setWriteFont(contentWriteFont);</span><br><span class="line">    <span class="comment">// 设置 水平居中</span></span><br><span class="line">    contentWriteCellStyle.setHorizontalAlignment(HorizontalAlignment.CENTER);</span><br><span class="line">    <span class="comment">// 设置 垂直居中</span></span><br><span class="line">    contentWriteCellStyle.setVerticalAlignment(VerticalAlignment.CENTER);</span><br><span class="line">    <span class="comment">// 设置单元格格式为 文本</span></span><br><span class="line">    <span class="type">DataFormatData</span> <span class="variable">dataFormatData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataFormatData</span>();</span><br><span class="line">    dataFormatData.setIndex((<span class="type">short</span>)<span class="number">49</span>);</span><br><span class="line">    contentWriteCellStyle.setDataFormatData(dataFormatData);</span><br><span class="line"></span><br><span class="line">    <span class="type">HorizontalCellStyleStrategy</span> <span class="variable">horizontalCellStyleStrategy</span> <span class="operator">=</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HorizontalCellStyleStrategy</span>(headWriteCellStyle, contentWriteCellStyle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//示例数据</span></span><br><span class="line">    List&lt;HjUserExportExcelVO&gt; example = <span class="built_in">this</span>.list(Wrappers.&lt;HjUserInfoDTO&gt;query().last(<span class="string">&quot;limit 3&quot;</span>)).stream().map(m -&gt;</span><br><span class="line">                                                                                                                getHjUserInfoById(m.getId())</span><br><span class="line">                                                                                                               ).collect(Collectors.toList()).stream().map(m -&gt; &#123;</span><br><span class="line">        <span class="type">HjUserExportExcelVO</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HjUserExportExcelVO</span>();</span><br><span class="line">        BeanUtil.copyProperties(m, vo);</span><br><span class="line">        vo.setCompanys(m.getCompany().getName());</span><br><span class="line">        vo.setDepts(m.getDept().get(<span class="number">0</span>).getName());</span><br><span class="line">        <span class="keyword">return</span> vo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;content-Type&quot;</span>, <span class="string">&quot;application/vnd.ms-excel&quot;</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(fileName, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置表名，引脚名，文件格式，list数据</span></span><br><span class="line">    EasyExcel.write(response.getOutputStream(), HjUserExportExcelVO.class)</span><br><span class="line">        .registerWriteHandler(horizontalCellStyleStrategy)</span><br><span class="line">        .registerWriteHandler(<span class="keyword">new</span> <span class="title class_">SpinnerWriteHandler</span>())</span><br><span class="line">        .sheet(<span class="string">&quot;模板&quot;</span>)</span><br><span class="line">        .doWrite(example);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpinnerWriteHandler</span> <span class="keyword">implements</span> <span class="title class_">SheetWriteHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SysDeptService sysDeptService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SysDictServiceImpl sysDictService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(SysDeptService sysDeptService, SysDictServiceImpl sysDictService)</span>&#123;</span><br><span class="line">        SpinnerWriteHandler.sysDeptService = sysDeptService;</span><br><span class="line">        SpinnerWriteHandler.sysDictService = sysDictService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterSheetCreate</span><span class="params">(WriteWorkbookHolder writeWorkbookHolder, WriteSheetHolder writeSheetHolder)</span> &#123;</span><br><span class="line">        <span class="comment">//部门数据</span></span><br><span class="line">        List&lt;String&gt; dept = sysDeptService.getDepts();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里的key值 对应导出列的顺序 从0开始</span></span><br><span class="line">        mapDropDown.put(<span class="number">0</span>, dept);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> writeSheetHolder.getSheet();</span><br><span class="line">        <span class="comment">/// 开始设置下拉框</span></span><br><span class="line">        <span class="type">DataValidationHelper</span> <span class="variable">helper</span> <span class="operator">=</span> sheet.getDataValidationHelper();<span class="comment">// 设置下拉框</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Integer, String[]&gt; entry : mapDropDown.entrySet())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*** 起始行、终止行、起始列、终止列 **/</span></span><br><span class="line">            <span class="type">CellRangeAddressList</span> <span class="variable">addressList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CellRangeAddressList</span>(<span class="number">1</span>, <span class="number">1000</span>, entry.getKey(), entry.getKey());</span><br><span class="line">            <span class="comment">/*** 设置下拉框数据 **/</span></span><br><span class="line">            <span class="type">DataValidationConstraint</span> <span class="variable">constraint</span> <span class="operator">=</span> helper.createExplicitListConstraint(entry.getValue());</span><br><span class="line">            <span class="type">DataValidation</span> <span class="variable">dataValidation</span> <span class="operator">=</span> helper.createValidation(constraint, addressList);</span><br><span class="line">            <span class="comment">/*** 处理Excel兼容性问题 **/</span></span><br><span class="line">            <span class="keyword">if</span> (dataValidation <span class="keyword">instanceof</span> XSSFDataValidation)</span><br><span class="line">            &#123;</span><br><span class="line">                dataValidation.setSuppressDropDownArrow(<span class="literal">true</span>);</span><br><span class="line">                dataValidation.setShowErrorBox(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                dataValidation.setSuppressDropDownArrow(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sheet.addValidationData(dataValidation);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下拉超过50条不显示解决方案</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinenoConfWriteHandler</span> <span class="keyword">implements</span> <span class="title class_">SheetWriteHandler</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//Dao</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Dao dao;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//加载spring容器中的Dao</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(Dao dao)</span>&#123;</span><br><span class="line">        LinenoConfWriteHandler.dao = dao;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">char</span>[] alphabet = <span class="keyword">new</span> <span class="title class_">char</span>[]&#123;<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterSheetCreate</span><span class="params">(WriteWorkbookHolder writeWorkbookHolder, WriteSheetHolder writeSheetHolder)</span> &#123;</span><br><span class="line">        <span class="comment">//通过dao获取的下拉数据数组</span></span><br><span class="line">        String[] datas = dao.get();</span><br><span class="line">            </span><br><span class="line">        <span class="comment">//存放下拉数据</span></span><br><span class="line">        Map&lt;Integer, String[]&gt; mapDropDown = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        mapDropDown.put(<span class="number">0</span>, datas);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开始设置下拉框</span></span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">sheet</span> <span class="operator">=</span> writeSheetHolder.getSheet();  </span><br><span class="line">        <span class="type">DataValidationHelper</span> <span class="variable">helper</span> <span class="operator">=</span> sheet.getDataValidationHelper();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//隐藏下拉数据的sheet</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dictSheetName</span> <span class="operator">=</span> <span class="string">&quot;sheet2&quot;</span>;</span><br><span class="line">        <span class="type">Workbook</span> <span class="variable">workbook</span> <span class="operator">=</span> writeWorkbookHolder.getWorkbook();</span><br><span class="line">        <span class="type">Sheet</span> <span class="variable">dictSheet</span> <span class="operator">=</span> workbook.createSheet(dictSheetName);</span><br><span class="line">        workbook.setSheetHidden(workbook.getSheetIndex(dictSheet), <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义列宽"><a href="#自定义列宽" class="headerlink" title="自定义列宽"></a>自定义列宽</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bda.huijun.common.excel.strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.enums.CellDataTypeEnum;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.metadata.Head;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.metadata.data.CellData;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.metadata.data.WriteCellData;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.metadata.holder.WriteSheetHolder;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.write.style.column.AbstractColumnWidthStyleStrategy;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Cell;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelCellWidthStyleStrategy</span> <span class="keyword">extends</span> <span class="title class_">AbstractColumnWidthStyleStrategy</span> &#123;</span><br><span class="line">    <span class="comment">// 可以根据这里的最大宽度，按自己需要进行调整,搭配单元格样式实现类中的，自动换行，效果更好</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_COLUMN_WIDTH</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">private</span>  Map&lt;Integer, Map&lt;Integer, Integer&gt;&gt; CACHE = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setColumnWidth</span><span class="params">(WriteSheetHolder writeSheetHolder, List&lt;WriteCellData&lt;?&gt;&gt; cellDataList, Cell cell, Head head, Integer relativeRowIndex, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">needSetWidth</span> <span class="operator">=</span> isHead || !CollectionUtils.isEmpty(cellDataList);</span><br><span class="line">        <span class="keyword">if</span> (needSetWidth) &#123;</span><br><span class="line">            Map&lt;Integer, Integer&gt; maxColumnWidthMap = (Map)CACHE.get(writeSheetHolder.getSheetNo());</span><br><span class="line">            <span class="keyword">if</span> (maxColumnWidthMap == <span class="literal">null</span>) &#123;</span><br><span class="line">                maxColumnWidthMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">16</span>);</span><br><span class="line">                CACHE.put(writeSheetHolder.getSheetNo(), maxColumnWidthMap);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">columnWidth</span> <span class="operator">=</span> <span class="built_in">this</span>.dataLength(cellDataList, cell, isHead);</span><br><span class="line">            <span class="keyword">if</span> (columnWidth &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (columnWidth &gt; MAX_COLUMN_WIDTH) &#123;</span><br><span class="line">                    columnWidth = MAX_COLUMN_WIDTH;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Integer</span> <span class="variable">maxColumnWidth</span> <span class="operator">=</span> (Integer)((Map)maxColumnWidthMap).get(cell.getColumnIndex());</span><br><span class="line">                <span class="keyword">if</span> (maxColumnWidth == <span class="literal">null</span> || columnWidth &gt; maxColumnWidth) &#123;</span><br><span class="line">                    ((Map)maxColumnWidthMap).put(cell.getColumnIndex(), columnWidth);</span><br><span class="line">                    writeSheetHolder.getSheet().setColumnWidth(cell.getColumnIndex(), columnWidth * <span class="number">256</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer <span class="title function_">dataLength</span><span class="params">(List&lt;WriteCellData&lt;?&gt;&gt; cellDataList, Cell cell, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isHead) &#123;</span><br><span class="line">            <span class="keyword">return</span> cell.getStringCellValue().getBytes().length;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">CellData</span> <span class="variable">cellData</span> <span class="operator">=</span> cellDataList.get(<span class="number">0</span>);</span><br><span class="line">            <span class="type">CellDataTypeEnum</span> <span class="variable">type</span> <span class="operator">=</span> cellData.getType();</span><br><span class="line">            <span class="keyword">if</span> (type == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">                    <span class="keyword">case</span> STRING:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getStringValue().getBytes().length;</span><br><span class="line">                    <span class="keyword">case</span> BOOLEAN:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getBooleanValue().toString().getBytes().length;</span><br><span class="line">                    <span class="keyword">case</span> NUMBER:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getNumberValue().toString().getBytes().length;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Hutool"><a href="#Hutool" class="headerlink" title="Hutool"></a>Hutool</h1><h2 id="DES加密"><a href="#DES加密" class="headerlink" title="DES加密"></a>DES加密</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">SymmetricCrypto</span> <span class="variable">des</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SymmetricCrypto</span>(SymmetricAlgorithm.DES, salt.getBytes());</span><br><span class="line"><span class="comment">//加密</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> des.encryptHex(<span class="string">&quot;12345678&quot;</span>);</span><br><span class="line"><span class="comment">//解密</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> des.decryptStr(s);</span><br></pre></td></tr></table></figure>

<h2 id="OkHttp3"><a href="#OkHttp3" class="headerlink" title="OkHttp3"></a>OkHttp3</h2><ul>
<li>支持 HTTP2&#x2F;SPDY <ul>
<li>&#x3D;&#x3D;SPDY&#x3D;&#x3D;是Google开发的基于TCP的传输层协议，用以最小化网络延迟，提升网络速度，优化用户的网络使用体验</li>
<li>共享Socket，对同一个主机发出的所有请求都可以共享相同的套接字连接，减少对服务器的请求次数</li>
<li>如果 HTTP&#x2F;2 和 SPDY 不可用，OkHttp 会使用连接池来复用连接以提高效率</li>
</ul>
</li>
<li>socket自动选择最好路线，并支持自动重连，拥有自动维护的socket连接池，减少握手次数，减少了请求延迟</li>
<li>当网络出现问题时，OkHttp 会自动重试一个主机的多个 IP 地址</li>
<li>&#x3D;&#x3D;基于Headers的缓存策略&#x3D;&#x3D;减少重复的网络请求</li>
<li>拥有&#x3D;&#x3D;Interceptors&#x3D;&#x3D;轻松处理请求与响应（自动处理&#x3D;&#x3D;GZip&#x3D;&#x3D;压缩）</li>
<li>&#x3D;&#x3D;Retrofit&#x3D;&#x3D;底层也是使用OkHttp</li>
<li>功能<ul>
<li>文件的上传下载</li>
<li>加载图片(内部会图片大小自动压缩)</li>
<li>支持请求回调，直接返回对象、对象集合</li>
<li>支持session的保持</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E5%B7%A5%E5%85%B7/" data-id="clrj8pzxt007y6wuwbewkfa3u" data-title="工具" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Note/后端/Java/开发/常用命令" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T13:12:24.689Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><ul>
<li>查看端口占用<ul>
<li>netstat -tuln 端口号</li>
<li>lsof -i:端口号</li>
</ul>
</li>
<li>复制<ul>
<li>cp  [选项] 源文件 目标文件<ul>
<li>-r：复制文件夹</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/Note/%E5%90%8E%E7%AB%AF/Java/%E5%BC%80%E5%8F%91/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" data-id="clrj8pzxu00806wuwanijbah3" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E4%B8%AD%E9%97%B4%E4%BB%B6/">Java中间件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E6%A1%86%E6%9E%B6/">Java框架</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web3/">Web3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%9B%E6%89%A3/">力扣</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A8%A1%E5%9D%97/">模块</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BA%90%E7%A0%81/">源码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95%E9%A2%98/">算法题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/">计算机知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/code/" rel="tag">code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/defi/" rel="tag">defi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/language/" rel="tag">language</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solidity/" rel="tag">solidity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web3/" rel="tag">web3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/" rel="tag">代码随想录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%98%E5%8C%96/" rel="tag">优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%91%E6%8C%87offer/" rel="tag">剑指offer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%9B%E6%89%A3%E7%83%AD%E9%A2%98100/" rel="tag">力扣热题100</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%9B%E6%89%A3%E9%A2%98/" rel="tag">力扣题</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E7%90%86/" rel="tag">原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A6%E7%A5%9E/" rel="tag">左神</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BA%93/" rel="tag">库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%80%E5%B7%A7/" rel="tag">技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/" rel="tag">数据结构和算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A8%A1%E5%9D%97/" rel="tag">模块</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A8%A1%E5%9E%8B/" rel="tag">模型</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%90%86%E5%BF%B5/" rel="tag">理念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B3%BB%E7%BB%9Fan-quan/" rel="tag">系统an&#39;quan</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" rel="tag">系统设计</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%84%E8%8C%83/" rel="tag">规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AE%E9%A2%98/" rel="tag">问题</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E6%88%90/" rel="tag">集成</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E7%BE%A4/" rel="tag">集群</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/code/" style="font-size: 10px;">code</a> <a href="/tags/defi/" style="font-size: 10px;">defi</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/language/" style="font-size: 10px;">language</a> <a href="/tags/solidity/" style="font-size: 10px;">solidity</a> <a href="/tags/web3/" style="font-size: 12.86px;">web3</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 20px;">中间件</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/" style="font-size: 10px;">代码随想录</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 10px;">优化</a> <a href="/tags/%E5%89%91%E6%8C%87offer/" style="font-size: 10px;">剑指offer</a> <a href="/tags/%E5%8A%9B%E6%89%A3%E7%83%AD%E9%A2%98100/" style="font-size: 10px;">力扣热题100</a> <a href="/tags/%E5%8A%9B%E6%89%A3%E9%A2%98/" style="font-size: 10px;">力扣题</a> <a href="/tags/%E5%8E%9F%E7%90%86/" style="font-size: 10px;">原理</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 15.71px;">基础</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E5%B7%A6%E7%A5%9E/" style="font-size: 10px;">左神</a> <a href="/tags/%E5%BA%93/" style="font-size: 10px;">库</a> <a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 18.57px;">开发</a> <a href="/tags/%E6%8A%80%E5%B7%A7/" style="font-size: 11.43px;">技巧</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">操作系统</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 12.86px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 11.43px;">数据结构</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/" style="font-size: 17.14px;">数据结构和算法</a> <a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 14.29px;">框架</a> <a href="/tags/%E6%A8%A1%E5%9D%97/" style="font-size: 15.71px;">模块</a> <a href="/tags/%E6%A8%A1%E5%9E%8B/" style="font-size: 11.43px;">模型</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 12.86px;">源码</a> <a href="/tags/%E7%90%86%E5%BF%B5/" style="font-size: 14.29px;">理念</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%B3%BB%E7%BB%9Fan-quan/" style="font-size: 10px;">系统an'quan</a> <a href="/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" style="font-size: 10px;">系统设计</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">网络</a> <a href="/tags/%E8%A7%84%E8%8C%83/" style="font-size: 10px;">规范</a> <a href="/tags/%E9%97%AE%E9%A2%98/" style="font-size: 10px;">问题</a> <a href="/tags/%E9%9B%86%E6%88%90/" style="font-size: 10px;">集成</a> <a href="/tags/%E9%9B%86%E7%BE%A4/" style="font-size: 10px;">集群</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 12.86px;">面试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/01/18/Note/%E9%9D%A2%E8%AF%95/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a>
          </li>
        
          <li>
            <a href="/2024/01/18/Note/%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/01/18/Note/%E9%9D%A2%E8%AF%95/%E8%8B%B1%E8%AF%AD/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/01/18/Note/%E9%9D%A2%E8%AF%95/%E5%9C%BA%E6%99%AF%E9%A2%98/">场景题</a>
          </li>
        
          <li>
            <a href="/2024/01/18/Note/%E9%9D%A2%E8%AF%95/%E6%95%B0%E6%8D%AE%E5%BA%93/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 JianHong<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>