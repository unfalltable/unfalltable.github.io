<!DOCTYPE html>
<html lang='en'>

<head>
  <meta name="generator" content="Hexo 7.0.0">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>框架设计 - JianHong</title>

  
    <meta name="description" content="实体类设计 继承Model实现CRUD 前提是需要有对应的Mapper类并基础BaseMapper&lt;T&gt;  123456789@Data@EqualsAndHashCode(callSuper &#x3D; true)@Accessors(chain &#x3D; true)public class User extends Model&lt;User&gt; &#123;    private Long">
<meta property="og:type" content="article">
<meta property="og:title" content="框架设计">
<meta property="og:url" content="http://example.com/2024/01/18/Note/Java/%E5%BC%80%E5%8F%91/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/index.html">
<meta property="og:site_name" content="JianHong">
<meta property="og:description" content="实体类设计 继承Model实现CRUD 前提是需要有对应的Mapper类并基础BaseMapper&lt;T&gt;  123456789@Data@EqualsAndHashCode(callSuper &#x3D; true)@Accessors(chain &#x3D; true)public class User extends Model&lt;User&gt; &#123;    private Long">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-01-18T13:12:24.691Z">
<meta property="article:modified_time" content="2023-09-11T17:16:56.000Z">
<meta property="article:author" content="JianHong">
<meta property="article:tag" content="框架">
<meta property="article:tag" content="开发">
<meta name="twitter:card" content="summary">
  
  
  
  <meta name="keywords" content="框架,开发">

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  

  

  


  
</head>

<body>
  

<div class="l_cover post"><div class="cover"><div class="lazy img bg" data-bg="https://source.unsplash.com/2000x400/?开发,框架"></div></div></div>


  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="title" href="/"><div class="main" ff="title">JianHong</div></a></div>

<nav class="menu dis-select"></nav>
</header>


<div class="widgets">
<widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" data-filter="/blog/" placeholder="文章搜索"><svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg></form><div id="search-result"></div><div class="search-no-result">No Results!</div></div></div></widget>


<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">框架设计</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E7%B1%BB%E8%AE%BE%E8%AE%A1"><span class="toc-text">实体类设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8"><span class="toc-text">数据字典</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-text">表结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">全局异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%93%8D%E5%BA%94%E7%B1%BB"><span class="toc-text">异常响应类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%96%AD%E8%A8%80%E6%8E%A5%E5%8F%A3"><span class="toc-text">异常断言接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%9E%9A%E4%B8%BE%E7%B1%BB"><span class="toc-text">异常枚举类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">异常拦截器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">全局返回值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%B8%B8%E9%87%8F%E4%BF%A1%E6%81%AF"><span class="toc-text">全局常量信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E5%A4%84%E7%90%86"><span class="toc-text">全局配置信息处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%88%86%E9%A1%B5%E5%A4%84%E7%90%86"><span class="toc-text">全局分页处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E5%85%A5%E5%8F%82"><span class="toc-text">分页入参</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E8%BF%94%E5%9B%9E%E5%A4%84%E7%90%86"><span class="toc-text">分页返回处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="toc-text">全局导入导出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%88%97%E5%AE%BD"><span class="toc-text">动态列宽</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%8D%95%E5%85%83%E6%A0%BC"><span class="toc-text">动态单元格</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86"><span class="toc-text">日志处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97"><span class="toc-text">接口操作日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#logback%E9%85%8D%E7%BD%AE"><span class="toc-text">logback配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E5%A4%84%E7%90%86"><span class="toc-text">权限处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%B0%81%E8%A3%85"><span class="toc-text">工具封装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">JWT工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mybatis%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">Mybatis工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">Redis工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Date%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">Date工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Security%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">Security工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Url%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">Url工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OkHttp3%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">OkHttp3工具类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SSLSocketClinet"><span class="toc-text">SSLSocketClinet</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">AOP工具类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90"><span class="toc-text">文档生成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-text">部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-compose"><span class="toc-text">Docker-compose</span></a></li></ol></li></ol></div></div></widget>




</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/unfalltable" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/social/08a41b181ce68.svg"/></a></div></footer>

    </aside>
    <div class='l_main'>
      

      



<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">Home</a><span class="sep"></span><a class="cap breadcrumb" href="/">Blog</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a></div><div id="post-meta">Posted on&nbsp;<time datetime="2024-01-18T13:12:24.691Z">2024-01-18</time></div></div>

<article class='md-text content post'>
<h1 class="article-title"><span>框架设计</span></h1>
<h2 id="实体类设计"><a href="#实体类设计" class="headerlink" title="实体类设计"></a>实体类设计</h2><ul>
<li>继承Model实现CRUD</li>
<li>前提是需要有对应的Mapper类并基础BaseMapper&lt;T&gt;</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">Model</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">test</span><span class="params">(UserParam userParam)</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    Beanutil.copyProperty(userParam, user);</span><br><span class="line">    <span class="comment">//增</span></span><br><span class="line">    user.insert();</span><br><span class="line">    <span class="comment">//删</span></span><br><span class="line">    user.deleteById();</span><br><span class="line">    <span class="comment">//改</span></span><br><span class="line">    user.updateById();</span><br><span class="line">    user.update(UpdateWrappers&lt;User&gt;对象);</span><br><span class="line">    <span class="comment">//查</span></span><br><span class="line">    user.selectById();</span><br><span class="line">    user.selectOne(QueryWrappers&lt;User&gt;对象);</span><br><span class="line">    user.selectPage(IPage对象, QueryWrappers&lt;User&gt;对象);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>重要数据的dto都需要继承该类，然后通过mybatis填充器自动填充操作信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">public class DbEntity&lt;T&gt; &#123;</span><br><span class="line">    //创建时间</span><br><span class="line">    @TableField(fill = FieldFill.INSERT)</span><br><span class="line">    private Date createTime;</span><br><span class="line"></span><br><span class="line">    //修改时间</span><br><span class="line">    @TableField(fill = FieldFill.INSERT_UPDATE)</span><br><span class="line">    private Date updateTime;</span><br><span class="line">    </span><br><span class="line">    //创建者ID</span><br><span class="line">    @TableField(fill = FieldFill.INSERT)</span><br><span class="line">    private T createBy;</span><br><span class="line">    </span><br><span class="line">    //修改着ID</span><br><span class="line">    @TableField(fill = FieldFill.INSERT_UPDATE)</span><br><span class="line">    private T updateBy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据字典"><a href="#数据字典" class="headerlink" title="数据字典"></a>数据字典</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul>
<li><p>构成</p>
<ul>
<li>字典组 -&gt; key-value</li>
</ul>
</li>
<li><p>字典可以做缓存，使用redis和lfu缓存淘汰策略</p>
</li>
</ul>
<h3 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h3><p>字典组</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>id</td>
</tr>
<tr>
<td>type</td>
<td>varchar</td>
<td>字典组名</td>
</tr>
<tr>
<td>show</td>
<td>char</td>
<td>表现形式 0 列表 1 树形</td>
</tr>
<tr>
<td>category</td>
<td>varchar</td>
<td>字典类型 系统内置、业务类</td>
</tr>
<tr>
<td>des</td>
<td>varchar</td>
<td>描述</td>
</tr>
<tr>
<td>remark</td>
<td>varchar</td>
<td>备注</td>
</tr>
</tbody></table>
<p>字典项</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td></td>
<td></td>
</tr>
<tr>
<td>pid</td>
<td></td>
<td>字典组id</td>
</tr>
<tr>
<td>type</td>
<td></td>
<td>字典组名</td>
</tr>
<tr>
<td>key</td>
<td></td>
<td>字典项key</td>
</tr>
<tr>
<td>value</td>
<td></td>
<td>字典项value</td>
</tr>
<tr>
<td>sort</td>
<td></td>
<td>排序值</td>
</tr>
<tr>
<td>des</td>
<td></td>
<td>描述</td>
</tr>
<tr>
<td>remark</td>
<td></td>
<td>备注</td>
</tr>
</tbody></table>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ul>
<li><p>Controller</p>
<ul>
<li>新增字典组</li>
<li>分页查询字典组信息</li>
<li>修改字典组</li>
<li>通过id删除字典组</li>
<li>新增字典项</li>
<li>分页查询字典项信息</li>
<li>修改字典项</li>
<li>树形查询字典项信息</li>
<li>通过id删除字典项</li>
<li>获取字典值 value</li>
<li>获取key-value</li>
<li>获取树形的key-value</li>
<li>获取key-value 无权限</li>
<li>获取字典值 value 无权限（无权限组）</li>
</ul>
</li>
<li><p>service</p>
</li>
<li><p>Impl</p>
<ul>
<li>注入DictServiceImpl（可以通过ApplicationContext）</li>
</ul>
</li>
<li><p>Mapper</p>
<ul>
<li>SysDictGroupMapper</li>
<li>SysDictMapper</li>
</ul>
</li>
</ul>
<h2 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h2><h3 id="异常响应类"><a href="#异常响应类" class="headerlink" title="异常响应类"></a>异常响应类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefRunException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> ExceptionEnum ex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefRunException</span><span class="params">(<span class="keyword">final</span> ExceptionEnum ex, <span class="keyword">final</span> String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        init(ex, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefRunException</span><span class="params">(<span class="keyword">final</span> ExceptionEnum ex, <span class="keyword">final</span> String message, <span class="keyword">final</span> Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">        init(ex, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ExceptionEnum ex, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.ex = ex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异常断言接口"><a href="#异常断言接口" class="headerlink" title="异常断言接口"></a>异常断言接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ExceptionAssert</span> &#123;</span><br><span class="line">    <span class="comment">//创建异常</span></span><br><span class="line">    DefRunException <span class="title function_">newException</span><span class="params">(Object... args)</span>;</span><br><span class="line">    DefRunException <span class="title function_">newException</span><span class="params">(Throwable t, Object... args)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//断言该对象不能为空对象</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">assertNotNull</span><span class="params">(Object obj, Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newException(args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="keyword">if</span> (((String) obj).length() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> newException(args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//断言是否True，是True则测试用例通过。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">assertTrue</span><span class="params">(<span class="type">boolean</span> isTrue, Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isTrue) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newException(args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//断言是否False，是False则测试用例通过。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">assertFalse</span><span class="params">(<span class="type">boolean</span> isTrue, Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isTrue) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newException(args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//有一个为 null</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">hasEmpty</span><span class="params">(String msg, Object... object)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtil.hasEmpty(object)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> newException(ObjectUtil.isNull(msg) ? <span class="string">&quot;参数不能为null!&quot;</span> : msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异常枚举类"><a href="#异常枚举类" class="headerlink" title="异常枚举类"></a>异常枚举类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsment</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ExceptionEnum</span> <span class="keyword">implements</span> <span class="title class_">ExceptionAssert</span> &#123;</span><br><span class="line">    <span class="comment">//内部异常（打印日志）</span></span><br><span class="line">    INNER_MSG(<span class="string">&quot;&#123;0&#125;&quot;</span>),</span><br><span class="line">    <span class="comment">//异常信息（返回给客户端异常信息）</span></span><br><span class="line">    CLIENT_MSG(<span class="string">&quot;&#123;0&#125;&quot;</span>),</span><br><span class="line">    <span class="comment">//异常编码，配置异常信息，返回给客户端</span></span><br><span class="line">    CLIENT_CODE(<span class="string">&quot;&#123;0&#125;&quot;</span>),</span><br><span class="line">    ;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DefRunException <span class="title function_">newException</span><span class="params">(Object... args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> MessageFormat.format(<span class="built_in">this</span>.getMessage(), args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefRunException</span>(<span class="built_in">this</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DefRunException <span class="title function_">newException</span><span class="params">(Throwable t, Object... args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> MessageFormat.format(<span class="built_in">this</span>.getMessage(), args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefRunException</span>(<span class="built_in">this</span>, msg, t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//直接抛配置好的异常信息给客户端</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">th</span><span class="params">(Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> newException(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//直接抛内部异常，打印日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">thro</span><span class="params">(Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> INNER_MSG.newException(args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//格式化输出 (&quot;aa &#123;&#125;&quot;, &quot;aa&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">format</span><span class="params">(String msg, Object... objects)</span> &#123;</span><br><span class="line">        <span class="type">FormattingTuple</span> <span class="variable">ft</span> <span class="operator">=</span> MessageFormatter.arrayFormat(msg, objects);</span><br><span class="line">        <span class="keyword">return</span> ft.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异常拦截器"><a href="#异常拦截器" class="headerlink" title="异常拦截器"></a>异常拦截器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionCatch</span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(想要拦截的异常)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">exception</span><span class="params">()</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        Log...;</span><br><span class="line">        <span class="keyword">return</span> R;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全局返回值"><a href="#全局返回值" class="headerlink" title="全局返回值"></a>全局返回值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">ok</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(CommonConstants.SUCCESS, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">ok</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(CommonConstants.SUCCESS, <span class="literal">null</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">failed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(CommonConstants.FAIL, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">failed</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(CommonConstants.FAIL, msg, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">bol</span><span class="params">(<span class="type">boolean</span> result)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bol(result, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> R <span class="title function_">bol</span><span class="params">(<span class="type">boolean</span> result, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> result ? R.ok() : R.failed(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">bol</span><span class="params">(T t, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.nonNull(t) ? R.ok(t) : R.failed(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全局常量信息"><a href="#全局常量信息" class="headerlink" title="全局常量信息"></a>全局常量信息</h2><ul>
<li>异常信息枚举类<ul>
<li>各种异常信息状态码和友好响应信息</li>
</ul>
</li>
<li>全局状态信息枚举类</li>
</ul>
<h2 id="全局配置信息处理"><a href="#全局配置信息处理" class="headerlink" title="全局配置信息处理"></a>全局配置信息处理</h2><ol>
<li><p>创建一个抽象类，提供一个抽象方法并在创建时初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SettingEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        defaultValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 必须初始化值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">defaultValue</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建需要全局统一管理的配置信息对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Gs</span> <span class="keyword">extends</span> <span class="title class_">GsSettingEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1629258515233154346L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对象内部要对值进行初始化，也需要继承 GsSettingEntity</span></span><br><span class="line">    <span class="meta">@Valid</span></span><br><span class="line">    <span class="keyword">private</span> Gs1 gs1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Valid</span></span><br><span class="line">    <span class="keyword">private</span> String str;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">defaultValue</span><span class="params">()</span> &#123;</span><br><span class="line">        gs1 = <span class="keyword">new</span> <span class="title class_">Gs1</span>();</span><br><span class="line">        <span class="built_in">this</span>.str = <span class="string">&quot;默认值&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="全局分页处理"><a href="#全局分页处理" class="headerlink" title="全局分页处理"></a>全局分页处理</h2><h3 id="分页入参"><a href="#分页入参" class="headerlink" title="分页入参"></a>分页入参</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">getPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> HttpServletUtil.getRequest();</span><br><span class="line">        <span class="keyword">switch</span> (HttpMethod.valueOf(request.getMethod())) &#123;</span><br><span class="line">            <span class="keyword">case</span> GET:</span><br><span class="line">                <span class="keyword">return</span> getPageOfGetReq(request);</span><br><span class="line">            <span class="keyword">case</span> POST:</span><br><span class="line">                <span class="comment">// TODO</span></span><br><span class="line">            <span class="keyword">default</span>:<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;T&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">getPageOfGetReq</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">p</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (ContentType.JSON.equals(request.getContentType())) &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ps = request.getParameter(CommonConstants.PAGE_SIZE);</span><br><span class="line">            p = request.getParameter(CommonConstants.PAGE_CURRENT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;T&gt;(Convert.toInt(p, CommonConstants.PAGE_CURRENT_DEFAULT), Convert.toInt(ps, CommonConstants.PAGE_SIZE_DEFAULT));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分页返回处理"><a href="#分页返回处理" class="headerlink" title="分页返回处理"></a>分页返回处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;S, T&gt; IPage&lt;T&gt; <span class="title function_">covert</span><span class="params">(IPage&lt;S&gt; s, Class&lt;T&gt; t, Function&lt;S, T&gt; convert)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(s);</span><br><span class="line">        Page&lt;T&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(s.getCurrent(), s.getSize(), s.getTotal());</span><br><span class="line">        page.setPages(s.getPages());</span><br><span class="line">        List&lt;S&gt; data = s.getRecords();</span><br><span class="line">        page.setRecords(data.stream().map(convert).collect(Collectors.toList()));</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;S, T&gt; IPage&lt;T&gt; <span class="title function_">covert</span><span class="params">(IPage&lt;S&gt; s, List&lt;S&gt; data, Class&lt;T&gt; t, Function&lt;S, T&gt; convert)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(s);</span><br><span class="line">        Objects.requireNonNull(data);</span><br><span class="line">        Page&lt;T&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(s.getCurrent(), s.getSize(), data.size());</span><br><span class="line">        page.setRecords(data.stream().map(convert).collect(Collectors.toList()));</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全局导入导出"><a href="#全局导入导出" class="headerlink" title="全局导入导出"></a>全局导入导出</h2><p>使用EasyExcel</p>
<h3 id="动态列宽"><a href="#动态列宽" class="headerlink" title="动态列宽"></a>动态列宽</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态列宽</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelCellWidthStyleStrategy</span> <span class="keyword">extends</span> <span class="title class_">AbstractColumnWidthStyleStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_COLUMN_WIDTH</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">private</span>  Map&lt;String, Map&lt;Integer, Integer&gt;&gt; CACHE = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setColumnWidth</span><span class="params">(WriteSheetHolder writeSheetHolder, List&lt;WriteCellData&lt;?&gt;&gt; cellDataList, Cell cell, Head head, Integer relativeRowIndex, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">needSetWidth</span> <span class="operator">=</span> isHead || !CollectionUtils.isEmpty(cellDataList);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> Objects.isNull(writeSheetHolder.getSheetNo()) ? writeSheetHolder.getSheetName(): writeSheetHolder.getSheetNo() + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (needSetWidth) &#123;</span><br><span class="line">            <span class="comment">// 获取 key -&gt; sheet 页各列的 宽度信息</span></span><br><span class="line">            Map&lt;Integer, Integer&gt; maxColumnWidthMap = CACHE.get(key);</span><br><span class="line">            <span class="keyword">if</span> (maxColumnWidthMap == <span class="literal">null</span>) &#123;</span><br><span class="line">                maxColumnWidthMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">                CACHE.put(key, maxColumnWidthMap);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 计算当前 单元格 内容的大小</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">columnWidth</span> <span class="operator">=</span> <span class="built_in">this</span>.dataLength(cellDataList, cell, isHead);</span><br><span class="line">            <span class="keyword">if</span> (columnWidth &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (columnWidth &gt; MAX_COLUMN_WIDTH) &#123;</span><br><span class="line">                    columnWidth = MAX_COLUMN_WIDTH;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Integer</span> <span class="variable">maxColumnWidth</span> <span class="operator">=</span> maxColumnWidthMap.get(cell.getColumnIndex());</span><br><span class="line">                <span class="comment">// 若当前单元格的大小大约该列最大值 更新该列宽度 并记录</span></span><br><span class="line">                <span class="keyword">if</span> (maxColumnWidth == <span class="literal">null</span> || columnWidth &gt; maxColumnWidth) &#123;</span><br><span class="line">                    maxColumnWidthMap.put(cell.getColumnIndex(), columnWidth);</span><br><span class="line">                    writeSheetHolder.getSheet().setColumnWidth(cell.getColumnIndex(), columnWidth * <span class="number">256</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer <span class="title function_">dataLength</span><span class="params">(List&lt;WriteCellData&lt;?&gt;&gt; cellDataList, Cell cell, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isHead) &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.min(cell.getStringCellValue().getBytes().length, <span class="string">&quot;默认宽度&quot;</span>.getBytes().length);</span><br><span class="line">            <span class="comment">// 以内容长度作为主要宽度 head 长度不作为主要宽度</span></span><br><span class="line">            <span class="comment">// return cell.getStringCellValue().getBytes().length;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            CellData&lt;?&gt; cellData = cellDataList.get(<span class="number">0</span>);</span><br><span class="line">            <span class="type">CellDataTypeEnum</span> <span class="variable">type</span> <span class="operator">=</span> cellData.getType();</span><br><span class="line">            <span class="keyword">if</span> (type == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">                    <span class="keyword">case</span> STRING:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getStringValue().getBytes().length;</span><br><span class="line">                    <span class="keyword">case</span> BOOLEAN:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getBooleanValue().toString().getBytes().length;</span><br><span class="line">                    <span class="keyword">case</span> NUMBER:</span><br><span class="line">                        <span class="keyword">return</span> cellData.getNumberValue().toString().getBytes().length;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="动态单元格"><a href="#动态单元格" class="headerlink" title="动态单元格"></a>动态单元格</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态单元格</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseExcelCellStyleStrategy</span> <span class="keyword">implements</span> <span class="title class_">CellWriteHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  Map&lt;String, Map&lt;Integer, String&gt;&gt; CACHE = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeCellCreate</span><span class="params">(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, Row row, Head head, Integer columnIndex, Integer relativeRowIndex, Boolean isHead)</span> &#123;</span><br><span class="line">        setCellStyle(writeSheetHolder, row.getSheet().getWorkbook(), row.getCell(columnIndex &gt; <span class="number">0</span> ? columnIndex - <span class="number">1</span> : columnIndex), isHead);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setCellStyle</span><span class="params">(WriteSheetHolder writeSheetHolder, Workbook workbook, Cell cell, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> Objects.isNull(writeSheetHolder.getSheetNo()) ? writeSheetHolder.getSheetName(): writeSheetHolder.getSheetNo() + <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 key -&gt; sheet 页 列标 和 列信息</span></span><br><span class="line">        Map&lt;Integer, String&gt; columnMap = CACHE.get(key);</span><br><span class="line">        <span class="keyword">if</span> (columnMap == <span class="literal">null</span>) &#123;</span><br><span class="line">            columnMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">            CACHE.put(key, columnMap);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算当前 单元格 内容的大小</span></span><br><span class="line">        <span class="keyword">if</span> (Objects.nonNull(cell)) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> cell.getColumnIndex();</span><br><span class="line">            <span class="type">String</span> <span class="variable">headInfo</span> <span class="operator">=</span> <span class="built_in">this</span>.getCellHeadInfo(cell, isHead);</span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isNotEmpty(headInfo)) &#123;</span><br><span class="line">                columnMap.put(index, headInfo);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                headInfo = columnMap.get(index);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isNotEmpty(headInfo)) &#123;</span><br><span class="line">                <span class="comment">// 有效的头部信息</span></span><br><span class="line">                fillCellStyle(key, headInfo, cell, workbook);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 设置这个单元格的样式</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> sheetName sheetName</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> headInfo 列头信息</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> cell 单元格信息</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> workbook</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">fillCellStyle</span><span class="params">(String sheetName, String headInfo, Cell cell, Workbook workbook)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getCellHeadInfo</span><span class="params">(Cell cell, Boolean isHead)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isHead) &#123;</span><br><span class="line">            <span class="keyword">return</span> cell.getStringCellValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="日志处理"><a href="#日志处理" class="headerlink" title="日志处理"></a>日志处理</h2><h3 id="接口操作日志"><a href="#接口操作日志" class="headerlink" title="接口操作日志"></a>接口操作日志</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> OperationLog &#123;</span><br><span class="line">    <span class="comment">/** 业务的名称,例如:&quot;修改菜单&quot; */</span></span><br><span class="line">    String <span class="title function_">title</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 业务操作类型枚举 */</span></span><br><span class="line">    LogOpTypeEnum <span class="title function_">opType</span><span class="params">()</span> <span class="keyword">default</span> LogOpTypeEnum.OTHER;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">LogOpTypeEnum</span> &#123;</span><br><span class="line">    <span class="comment">//其它 增加   删除    编辑   更新    查询 </span></span><br><span class="line">    OTHER, ADD, DELETE, EDIT, UPDATE, QUERY,  </span><br><span class="line">    <span class="comment">//详情   树   导入   导出   授权   强退  清空  </span></span><br><span class="line">    DETAIL,TREE,IMPORT,EXPORT,GRANT,FORCE,CLEAN,</span><br><span class="line">    <span class="comment">//修改状态 </span></span><br><span class="line">    CHANGE_STATUS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OperationLogAop</span> &#123;</span><br><span class="line">    <span class="comment">//日志切入点</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.bda.huijun.common.web.aop.log.OperationLog)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getLogPointCut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="comment">//操作成功返回结果记录日志</span></span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;getLogPointCut()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span> &#123;</span><br><span class="line">        common(joinPoint, result, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//操作发生异常记录日志</span></span><br><span class="line">    <span class="meta">@AfterThrowing(pointcut = &quot;getLogPointCut()&quot;, throwing = &quot;exception&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterThrowing</span><span class="params">(JoinPoint joinPoint, Exception exception)</span> &#123;</span><br><span class="line">        common(joinPoint, exception, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">common</span><span class="params">(JoinPoint joinPoint, Object obj, <span class="type">boolean</span> isSucess)</span> &#123;</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> methodSignature.getMethod();</span><br><span class="line">        <span class="type">OperationLog</span> <span class="variable">operationLog</span> <span class="operator">=</span> method.getAnnotation(OperationLog.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">account</span> <span class="operator">=</span> ApplicationContextHolder.getBean(LogConfigurationAdapter.class).getLoggingUserId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> AopUtils.getClassName(joinPoint);</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> AopUtils.getMethodName(joinPoint);</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodParameter</span> <span class="operator">=</span> AopUtils.getArgsJsonString(joinPoint);</span><br><span class="line">        <span class="comment">//异步记录日志</span></span><br><span class="line">        <span class="keyword">if</span> (isSucess) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (LogOpTypeEnum.EXPORT == operationLog.opType() || LogOpTypeEnum.IMPORT == operationLog.opType()) &#123;</span><br><span class="line">                result = JSON.toJSONString(R.ok(operationLog.opType().name() + <span class="string">&quot; sucessful!!!&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Objects.nonNull(obj) &amp;&amp; (result = JSON.toJSONString(obj)).length() &gt; <span class="number">256</span>) &#123;</span><br><span class="line">                result = result.substring(<span class="number">0</span>, <span class="number">256</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            LogManager.me().executeOperationLog(operationLog, account, className, methodName, methodParameter, result);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LogManager.me().executeExceptionLog(operationLog, account, className, methodName, methodParameter, (Exception) obj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogManager</span> &#123;</span><br><span class="line">	<span class="comment">//异步操作记录日志的线程池</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ScheduledThreadPoolExecutor</span> <span class="variable">EXECUTOR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScheduledThreadPoolExecutor</span>(<span class="number">10</span>, <span class="keyword">new</span> <span class="title class_">ScheduledExecutorFactoryBean</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LogManager</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//单例模式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">LogManager</span> <span class="variable">LOG_MANAGER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogManager</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LogManager <span class="title function_">me</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LOG_MANAGER;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//异步执行日志的方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">executeLog</span><span class="params">(TimerTask task)</span> &#123;</span><br><span class="line">        <span class="comment">//如果演示模式开启，则不记录日志</span></span><br><span class="line">        <span class="keyword">if</span> (LogProperties.DEMO.equals(LogProperties.me().getModel())) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//日志记录操作延时</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">operateDelayTime</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        EXECUTOR.schedule(task, operateDelayTime, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//登录日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeLoginLog</span><span class="params">(<span class="keyword">final</span> String account, <span class="keyword">final</span> String success, <span class="keyword">final</span> String failMessage)</span> &#123;</span><br><span class="line">        <span class="type">SysVisLog</span> <span class="variable">sysVisLog</span> <span class="operator">=</span> <span class="built_in">this</span>.genBaseSysVisLog();</span><br><span class="line">        <span class="type">TimerTask</span> <span class="variable">timerTask</span> <span class="operator">=</span> LogTaskFactory.loginLog(sysVisLog, account, success, failMessage);</span><br><span class="line">        executeLog(timerTask);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//登出日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeExitLog</span><span class="params">(<span class="keyword">final</span> String account)</span> &#123;</span><br><span class="line">        <span class="type">SysVisLog</span> <span class="variable">sysVisLog</span> <span class="operator">=</span> <span class="built_in">this</span>.genBaseSysVisLog();</span><br><span class="line">        <span class="type">TimerTask</span> <span class="variable">timerTask</span> <span class="operator">=</span> LogTaskFactory.exitLog(sysVisLog, account);</span><br><span class="line">        executeLog(timerTask);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//操作日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeOperationLog</span><span class="params">(OperationLog operationLog, <span class="keyword">final</span> String account, String className, String methodName, String methodParameter, <span class="keyword">final</span> String result)</span> &#123;</span><br><span class="line">        <span class="type">SysOpLog</span> <span class="variable">sysOpLog</span> <span class="operator">=</span> <span class="built_in">this</span>.genBaseSysOpLog();</span><br><span class="line">        <span class="type">TimerTask</span> <span class="variable">timerTask</span> <span class="operator">=</span> LogTaskFactory.operationLog(sysOpLog, account, operationLog, className, methodName, methodParameter, result);</span><br><span class="line">        executeLog(timerTask);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//异常日志</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeExceptionLog</span><span class="params">(OperationLog operationLog, <span class="keyword">final</span> String account, String className, String methodName, String methodParameter, Exception exception)</span> &#123;</span><br><span class="line">        <span class="type">SysOpLog</span> <span class="variable">sysOpLog</span> <span class="operator">=</span> <span class="built_in">this</span>.genBaseSysOpLog();</span><br><span class="line">        <span class="type">TimerTask</span> <span class="variable">timerTask</span> <span class="operator">=</span> LogTaskFactory.exceptionLog(sysOpLog, account, operationLog, className, methodName, methodParameter, exception);</span><br><span class="line">        executeLog(timerTask);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//构建基础访问日志</span></span><br><span class="line">    <span class="keyword">private</span> SysVisLog <span class="title function_">genBaseSysVisLog</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> HttpServletUtil.getRequest();</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtil.isNotNull(request)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> IpUtils.getClientIP(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> IpAddressUtils.getAddressResult(ip);</span><br><span class="line">            <span class="type">String</span> <span class="variable">browser</span> <span class="operator">=</span> UaUtil.getBrowser(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">os</span> <span class="operator">=</span> UaUtil.getOs(request);</span><br><span class="line">            <span class="keyword">return</span> LogFactory.genBaseSysVisLog(ip, address, browser, os);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;request is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//构建基础操作日志</span></span><br><span class="line">    <span class="keyword">private</span> SysOpLog <span class="title function_">genBaseSysOpLog</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> HttpServletUtil.getRequest();</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtil.isNotNull(request)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> IpUtils.getClientIP(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> IpAddressUtils.getAddressResult(ip);</span><br><span class="line">            <span class="type">String</span> <span class="variable">browser</span> <span class="operator">=</span> UaUtil.getBrowser(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">os</span> <span class="operator">=</span> UaUtil.getOs(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">            <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">            <span class="type">SysOpLog</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.genBaseSysOpLog(ip, address, browser, os, url, method);</span><br><span class="line">            log.setApp(ApplicationContextHolder.getServerName());</span><br><span class="line">            <span class="keyword">return</span> log;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;request is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="logback配置"><a href="#logback配置" class="headerlink" title="logback配置"></a>logback配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="权限处理"><a href="#权限处理" class="headerlink" title="权限处理"></a>权限处理</h2><ul>
<li><p>使用 @PreAuthorize(“@pms.hasPermission(“权限字段”)”) 进行权限配置</p>
</li>
<li><p>主要分为四种使用场景来设计</p>
<ul>
<li><p>外部访问内部有可能造成危险的接口</p>
<ul>
<li>对用户进行登录校验</li>
<li>对用户进行登录校验和权限校验</li>
</ul>
</li>
<li><p>外部访问内部安全的接口</p>
<ul>
<li>通过配置文件配置添加忽略路径</li>
<li>通过 @Inner注解</li>
<li>通过配置类</li>
</ul>
</li>
<li><p>内部访问内部接口</p>
<ul>
<li>通过OpenFeign进行远程调用</li>
</ul>
</li>
<li><p>访问第三方接口</p>
<ul>
<li>通过OpenFeign进行远程调用</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="工具封装"><a href="#工具封装" class="headerlink" title="工具封装"></a>工具封装</h2><h3 id="JWT工具类"><a href="#JWT工具类" class="headerlink" title="JWT工具类"></a>JWT工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// TOKEN的有效期一天(S)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TOKEN_TIME_OUT</span> <span class="operator">=</span> <span class="number">3</span> <span class="number">600</span>;</span><br><span class="line">    <span class="comment">// 加密KEY</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOKEN_ENCRY_KEY</span> <span class="operator">=</span> <span class="string">&quot;MDk4ZjziY200NjIxZDM3M2NhZGUOZTgzMjYyN2I0zjy&quot;</span>;</span><br><span class="line">    <span class="comment">// 最小刷新间隔(S)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REFRESH_TIME</span> <span class="operator">=</span> <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生产ID</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getToken</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        Map&lt;String，Object&gt; claimMaps = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        claimMaps.put(<span class="string">&quot;id&quot;</span>,id);</span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">return</span> Jwts .builder()</span><br><span class="line">            .setId(UUID.randomUUID().toString())</span><br><span class="line">            .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>(currentTime))<span class="comment">//签发时间   </span></span><br><span class="line">            .setSubject(<span class="string">&quot;system&quot;</span>) <span class="comment">//说明</span></span><br><span class="line">            .setIssuer(<span class="string">&quot;heima&quot;</span>) <span class="comment">//签发者信息</span></span><br><span class="line">            .setAudience(<span class="string">&quot;app&quot;</span>)<span class="comment">//接收用户</span></span><br><span class="line">            .compresswith(CompressionCodecs.GZIP) <span class="comment">//数据压缩方式</span></span><br><span class="line">            .signwith(SignatureAlgorithm.HS512，generalKey()) <span class="comment">//加密方式</span></span><br><span class="line">            .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(currentTime + TOKEN_TIME_OUT * <span class="number">1000</span>)) <span class="comment">//过期时间</span></span><br><span class="line">            .addClaims(claimMaps) <span class="comment">//cla信息</span></span><br><span class="line">    		.compact();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Mybatis工具类"><a href="#Mybatis工具类" class="headerlink" title="Mybatis工具类"></a>Mybatis工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">getPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> HttpServletUtil.getRequest();</span><br><span class="line">        <span class="keyword">switch</span> (HttpMethod.valueOf(request.getMethod())) &#123;</span><br><span class="line">            <span class="keyword">case</span> GET:</span><br><span class="line">                <span class="keyword">return</span> getPageOfGetReq(request);</span><br><span class="line">            <span class="keyword">case</span> POST:</span><br><span class="line">                <span class="comment">// TODO</span></span><br><span class="line">            <span class="keyword">default</span>:<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;T&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">getPageOfGetReq</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">p</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (ContentType.JSON.equals(request.getContentType())) &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ps = request.getParameter(CommonConstants.PAGE_SIZE);</span><br><span class="line">            p = request.getParameter(CommonConstants.PAGE_CURRENT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;T&gt;(Convert.toInt(p, CommonConstants.PAGE_CURRENT_DEFAULT), Convert.toInt(ps, CommonConstants.PAGE_SIZE_DEFAULT));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis工具类"><a href="#Redis工具类" class="headerlink" title="Redis工具类"></a>Redis工具类</h3><h3 id="Date工具类"><a href="#Date工具类" class="headerlink" title="Date工具类"></a>Date工具类</h3><h3 id="Security工具类"><a href="#Security工具类" class="headerlink" title="Security工具类"></a>Security工具类</h3><h3 id="Url工具类"><a href="#Url工具类" class="headerlink" title="Url工具类"></a>Url工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UrlUtils</span> &#123;</span><br><span class="line">    <span class="comment">//判断一个字符串是否为url</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isURL</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="comment">//转换为小写</span></span><br><span class="line">        str = str.toLowerCase();</span><br><span class="line">        <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;^((https|http|ftp|rtsp|mms)?://)&quot;</span>  <span class="comment">//https、http、ftp、rtsp、mms</span></span><br><span class="line">                + <span class="string">&quot;?(([0-9a-z_!~*&#x27;().&amp;=+$%-]+: )?[0-9a-z_!~*&#x27;().&amp;=+$%-]+@)?&quot;</span> <span class="comment">//ftp的user@</span></span><br><span class="line">                + <span class="string">&quot;(([0-9]&#123;1,3&#125;\\.)&#123;3&#125;[0-9]&#123;1,3&#125;&quot;</span> <span class="comment">// IP形式的URL- 例如：199.194.52.184</span></span><br><span class="line">                + <span class="string">&quot;|&quot;</span> <span class="comment">// 允许IP和DOMAIN（域名）</span></span><br><span class="line">                + <span class="string">&quot;([0-9a-z_!~*&#x27;()-]+\\.)*&quot;</span> <span class="comment">// 域名- www.</span></span><br><span class="line">                + <span class="string">&quot;([0-9a-z][0-9a-z-]&#123;0,61&#125;)?[0-9a-z]\\.&quot;</span> <span class="comment">// 二级域名</span></span><br><span class="line">                + <span class="string">&quot;[a-z]&#123;2,6&#125;)&quot;</span> <span class="comment">// first level domain- .com or .museum</span></span><br><span class="line">                + <span class="string">&quot;(:[0-9]&#123;1,5&#125;)?&quot;</span> <span class="comment">// 端口号最大为65535,5位数</span></span><br><span class="line">                + <span class="string">&quot;((/?)|&quot;</span> <span class="comment">// a slash isn&#x27;t required if there is no file name</span></span><br><span class="line">                + <span class="string">&quot;(/[0-9a-z_!~*&#x27;().;?:@&amp;=+$,%#-]+)+/?)$&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>  str.matches(regex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析出url参数中的键值对</span></span><br><span class="line">    <span class="comment">//如 &quot;index.jsp?Action=del&amp;id=123&quot;，解析出Action:del,id:123存入map中 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">URLRequest</span><span class="params">(String URL)</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; mapRequest = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">        String[] arrSplit = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strUrlParam</span> <span class="operator">=</span> TruncateUrlPage(URL);</span><br><span class="line">        <span class="keyword">if</span> (strUrlParam == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mapRequest;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//每一个键值为一组 www.2cto.com</span></span><br><span class="line">        arrSplit = strUrlParam.split(<span class="string">&quot;[&amp;]&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String strSplit : arrSplit) &#123;</span><br><span class="line">            String[] arrSplitEqual = <span class="literal">null</span>;</span><br><span class="line">            arrSplitEqual = strSplit.split(<span class="string">&quot;[=]&quot;</span>);</span><br><span class="line">            <span class="comment">//解析出键值</span></span><br><span class="line">            <span class="keyword">if</span> (arrSplitEqual.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">//正确解析</span></span><br><span class="line">                mapRequest.put(arrSplitEqual[<span class="number">0</span>], arrSplitEqual[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (arrSplitEqual[<span class="number">0</span>] != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                    <span class="comment">//只有参数没有值，不加入</span></span><br><span class="line">                    mapRequest.put(arrSplitEqual[<span class="number">0</span>], <span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mapRequest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//去掉url中的路径，留下请求参数部分 </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">TruncateUrlPage</span><span class="params">(String strURL)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strAllParam</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        String[] arrSplit = <span class="literal">null</span>;</span><br><span class="line">        strURL = strURL.trim();</span><br><span class="line">        arrSplit = strURL.split(<span class="string">&quot;[?]&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (strURL.length() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arrSplit.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (arrSplit[<span class="number">1</span>] != <span class="literal">null</span>) &#123;</span><br><span class="line">                    strAllParam = arrSplit[<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> strAllParam;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getIPAddress</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//X-Forwarded-For：Squid 服务代理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ipAddresses</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;X-Forwarded-For&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses == <span class="literal">null</span> || ipAddresses.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            <span class="comment">//Proxy-Client-IP：apache 服务代理</span></span><br><span class="line">            ipAddresses = request.getHeader(<span class="string">&quot;Proxy-Client-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses == <span class="literal">null</span> || ipAddresses.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            <span class="comment">//WL-Proxy-Client-IP：weblogic 服务代理</span></span><br><span class="line">            ipAddresses = request.getHeader(<span class="string">&quot;WL-Proxy-Client-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses == <span class="literal">null</span> || ipAddresses.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            <span class="comment">//HTTP_CLIENT_IP：有些代理服务器</span></span><br><span class="line">            ipAddresses = request.getHeader(<span class="string">&quot;HTTP_CLIENT_IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses == <span class="literal">null</span> || ipAddresses.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            <span class="comment">//X-Real-IP：nginx服务代理</span></span><br><span class="line">            ipAddresses = request.getHeader(<span class="string">&quot;X-Real-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//有些网络通过多层代理，那么获取到的ip就会有多个，一般都是通过逗号（,）分割开来，并且第一个ip为客户端的真实IP</span></span><br><span class="line">        <span class="keyword">if</span> (ipAddresses != <span class="literal">null</span> &amp;&amp; ipAddresses.length() != <span class="number">0</span>) &#123;</span><br><span class="line">            ip = ipAddresses.split(<span class="string">&quot;,&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//还是不能获取到，最后再通过request.getRemoteAddr();获取</span></span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="literal">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ipAddresses)) &#123;</span><br><span class="line">            ip = request.getRemoteAddr();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ip;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OkHttp3工具类"><a href="#OkHttp3工具类" class="headerlink" title="OkHttp3工具类"></a>OkHttp3工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OkHttp3Utils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">OkHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">OkHttpClient</span> <span class="variable">httpsClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">OkHttpClient</span> <span class="variable">httpsClientW</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> Type.HTTP;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">        <span class="comment">//http, https, https 绕过</span></span><br><span class="line">        HTTP, HTTPS, HTTPSW;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">get</span><span class="params">(<span class="keyword">final</span> String url)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> commonRequest(url, Request.Builder::get);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// application/x-www-form-urlencoded</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8from</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> Map&lt;String, String&gt; parameters)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> post8from(url, formBody -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (parameters == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessError</span>(<span class="string">&quot;parameters is null!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(Map.Entry&lt;String, String&gt; entry : parameters.entrySet()) &#123;</span><br><span class="line">                    formBody.add(entry.getKey(), entry.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// application/x-www-form-urlencoded</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8from</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> String... values)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> post8from(url, formBody -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (values != <span class="literal">null</span> &amp;&amp; values.length &gt; <span class="number">2</span> &amp;&amp; values.length%<span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; values.length;) &#123;</span><br><span class="line">                    formBody.add(values[index++], values[index++]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// application/x-www-form-urlencoded</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8from</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> Consumer&lt;FormBody.Builder&gt; consumer)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        FormBody.<span class="type">Builder</span> <span class="variable">formBody</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormBody</span>.Builder();</span><br><span class="line">        consumer.accept(formBody);</span><br><span class="line">        <span class="type">RequestBody</span> <span class="variable">requestBody</span> <span class="operator">=</span> formBody.build();</span><br><span class="line">        <span class="keyword">return</span> commonRequest(url, builder -&gt; builder.post(requestBody));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// application/json</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8json</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> Object jsonObject)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (jsonObject == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessError</span>(<span class="string">&quot;jsonObject is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> post8json(url, JSONObject.toJSONString(jsonObject));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// application/json</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8json</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> String json)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (json == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessError</span>(<span class="string">&quot;json is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">RequestBody</span> <span class="variable">body</span> <span class="operator">=</span> RequestBody.create(MediaType.parse(<span class="string">&quot;application/json; charset=utf-8&quot;</span>), json);</span><br><span class="line">        <span class="keyword">return</span> commonRequest(url, builder -&gt; builder.post(body));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// application/json</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post8json</span><span class="params">(<span class="keyword">final</span> Consumer&lt;Request.Builder&gt; header, <span class="keyword">final</span> String url, <span class="keyword">final</span> String json)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (json == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessError</span>(<span class="string">&quot;json is null!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">RequestBody</span> <span class="variable">body</span> <span class="operator">=</span> RequestBody.create(MediaType.parse(<span class="string">&quot;application/json; charset=utf-8&quot;</span>), json);</span><br><span class="line">        <span class="keyword">return</span> commonRequest(url, builder -&gt; &#123;</span><br><span class="line">                header.accept(builder);</span><br><span class="line">                builder.post(body);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">checkHttpUrl</span><span class="params">(<span class="keyword">final</span> String url)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO 汉子处理</span></span><br><span class="line">        <span class="comment">/*if (url == null || !UrlUtils.isURL(url)) &#123;</span></span><br><span class="line"><span class="comment">            throw new IllegalArgumentException(&quot;Http 请求 Url 错误: &quot; + url);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">commonRequest</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> Consumer&lt;Request.Builder&gt; consumer)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Request.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder().url(checkHttpUrl(url));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 请求做成</span></span><br><span class="line">        consumer.accept(builder);</span><br><span class="line">        <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> builder.build();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Call</span> <span class="variable">call</span> <span class="operator">=</span> getHttpClient().newCall(request);</span><br><span class="line">        <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> call.execute();</span><br><span class="line">        <span class="keyword">return</span> Objects.requireNonNull(response.body()).string();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> String <span class="title function_">executeHttpRequest</span><span class="params">(Supplier&lt;String&gt; http, Type type)</span> &#123;</span><br><span class="line">        String result;</span><br><span class="line">        OkHttp3Utils.type = type;</span><br><span class="line">        result = http.get();</span><br><span class="line">        OkHttp3Utils.type = Type.HTTP;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> OkHttpClient <span class="title function_">getHttpClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">OkHttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> HTTP:</span><br><span class="line">                <span class="keyword">if</span> (httpClient == <span class="literal">null</span>) &#123;</span><br><span class="line">                    httpClient = <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.Builder()</span><br><span class="line">                            <span class="comment">// 设置连接超时时间</span></span><br><span class="line">                            .connectTimeout(<span class="number">60</span>, TimeUnit.SECONDS)</span><br><span class="line">                            <span class="comment">//设置读取超时时间</span></span><br><span class="line">                            .readTimeout(<span class="number">60</span>, TimeUnit.SECONDS)</span><br><span class="line">                            .build();</span><br><span class="line">                &#125;</span><br><span class="line">                client = httpClient;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> HTTPS:</span><br><span class="line">                <span class="comment">// 暂时不用</span></span><br><span class="line">            <span class="keyword">case</span> HTTPSW:</span><br><span class="line">                <span class="keyword">if</span> (httpsClientW == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">X509TrustManager</span> <span class="variable">manager</span> <span class="operator">=</span> SSLSocketClient.getX509TrustManager();</span><br><span class="line">                    OkHttpClient.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.Builder();</span><br><span class="line">                    builder.sslSocketFactory(SSLSocketClient.getSocketFactory(manager), manager);</span><br><span class="line">                    builder.hostnameVerifier(SSLSocketClient.getHostnameVerifier());</span><br><span class="line">                    httpsClientW = builder</span><br><span class="line">                            <span class="comment">// 设置连接超时时间</span></span><br><span class="line">                            .connectTimeout(<span class="number">60</span>, TimeUnit.SECONDS)</span><br><span class="line">                            <span class="comment">//设置读取超时时间</span></span><br><span class="line">                            .readTimeout(<span class="number">60</span>, TimeUnit.SECONDS)</span><br><span class="line">                            .build();</span><br><span class="line">                &#125;</span><br><span class="line">                client = httpsClientW;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// nothing do to.</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 重置</span></span><br><span class="line">        type = Type.HTTP;</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SSLSocketClinet"><a href="#SSLSocketClinet" class="headerlink" title="SSLSocketClinet"></a>SSLSocketClinet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ssl 绕过</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSLSocketClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SSLSocketFactory <span class="title function_">getSocketFactory</span><span class="params">(TrustManager manager)</span> &#123;</span><br><span class="line">        <span class="type">SSLSocketFactory</span> <span class="variable">socketFactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SSLContext</span> <span class="variable">sslContext</span> <span class="operator">=</span> SSLContext.getInstance(<span class="string">&quot;SSL&quot;</span>);</span><br><span class="line">            sslContext.init(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">TrustManager</span>[]&#123;manager&#125;, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">            socketFactory = sslContext.getSocketFactory();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> socketFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> X509TrustManager <span class="title function_">getX509TrustManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">X509TrustManager</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">X509Certificate</span>[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HostnameVerifier <span class="title function_">getHostnameVerifier</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HostnameVerifier</span> <span class="variable">hostnameVerifier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HostnameVerifier</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(String s, SSLSession sslSession)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> hostnameVerifier;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AOP工具类"><a href="#AOP工具类" class="headerlink" title="AOP工具类"></a>AOP工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UtilityClass</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getClassName</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> joinPoint.getTarget().getClass().getName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getSimpleClassName</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> getClassName(joinPoint);</span><br><span class="line">        <span class="keyword">return</span> className.substring(className.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getMethodName</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> joinPoint.getSignature().getName();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//获取切面的参数json</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getArgsJsonString</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">argsJson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="keyword">for</span> (Object arg : args) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isFilterObject(arg)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ObjectUtil.isNotNull(arg)) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">jsonStr</span> <span class="operator">=</span> JSON.toJSONString(arg);</span><br><span class="line">                    argsJson.append(jsonStr).append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> argsJson.toString().trim();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//判断是否需要拼接参数，过滤掉HttpServletRequest,MultipartFile,HttpServletResponse等类型参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isFilterObject</span><span class="params">(Object arg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> arg <span class="keyword">instanceof</span> MultipartFile || arg <span class="keyword">instanceof</span> HttpServletRequest || arg <span class="keyword">instanceof</span> HttpServletResponse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文档生成"><a href="#文档生成" class="headerlink" title="文档生成"></a>文档生成</h2><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><h3 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h3><ol>
<li>需要将各个模块分别部署，所有模块需要在同一级目录下<ul>
<li>mysql需要打包配置和数据</li>
</ul>
</li>
<li>编写对应的 DockerFile 文件</li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一阶段</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span> as builder</span><br><span class="line"><span class="comment"># 工作目录为/build 相对目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /build</span></span><br><span class="line"><span class="comment"># 设置常量</span></span><br><span class="line"><span class="keyword">ARG</span> JAR_FILE=./模块名.jar</span><br><span class="line"><span class="comment"># 拷贝target/模块名.jar  到/build/app.jar</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> <span class="variable">$&#123;JAR_FILE&#125;</span> app.jar</span></span><br><span class="line"><span class="comment"># 执行shell命令 使用分层 这里就是解压jar包分层成各个目录  目的是为了更新的时候局部更新 加快镜像pull速度</span></span><br><span class="line"><span class="comment"># /build/dependencies</span></span><br><span class="line"><span class="comment"># /build/snapshot-dependencies</span></span><br><span class="line"><span class="comment"># /build/spring-boot-loader</span></span><br><span class="line"><span class="comment"># /build/application</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> java -Djarmode=layertools -jar app.jar extract &amp;&amp; <span class="built_in">rm</span> app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二阶段 引用第一阶段的镜像builder</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> <span class="number">569421432</span>@qq.com</span><br><span class="line"><span class="keyword">ENV</span> JAVA_OPTS=<span class="string">&quot;-Xms1024m -Xmx1024m -Duser.timezone=GMT+8 -DNACOS_HOST=10.1.3.160 -Djava.security.egd=file:/dev/./urandom&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_EX=<span class="string">&quot;-DMYSQL_HOST=192.168.8.91 -DMYSQL_PORT=3306 -DMYSQL_PWD=hj@123456 -DMYSQL_DB=bling -DREDIS_HOST=192.168.8.91 -DREDIS_PWD=hj@123456 -Dspring.profiles.active=test&quot;</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /opt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将builder（第一阶段）的文件copy到/opt</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /build/dependencies/ ./</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /build/snapshot-dependencies/ ./</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /build/spring-boot-loader/ ./</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /build/application/ ./</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 容器启动时执行</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> java <span class="variable">$JAVA_OPTS</span> <span class="variable">$JAVA_EX</span> org.springframework.boot.loader.JarLauncher</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写一个方便重新启动的文件 <code>restart.sh</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ &quot;$1&quot; = &#x27;&#x27; ]; then</span><br><span class="line">    echo &quot;You need to enter a project name!&quot;</span><br><span class="line">else</span><br><span class="line">    docker-compose stop $1</span><br><span class="line">    docker-compose rm -f $1</span><br><span class="line">    docker-compose build $1</span><br><span class="line">    docker-compose up -d $1</span><br><span class="line">    echo &quot;ok !!!&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启动：<code>./restart.sh 模块名</code></li>
</ol>



<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>License</span></div><div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">Newer</div><a href="/2024/01/18/Note/Java/%E5%BC%80%E5%8F%91/%E9%9B%86%E7%BE%A4/">集群</a></div><div class="item" id="next"><div class="note">Older</div><a href="/2024/01/18/Note/Java/%E5%BC%80%E5%8F%91/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计</a></div></section></div>








      
<footer class="page-footer reveal fs12"><hr><div class="text"><p>本站由 <a href="/">@anonymity</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = stellar.config.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.19.0';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0';
  stellar.config = {
    date_suffix: {
      just: 'Just',
      min: 'minutes ago',
      hour: 'hours ago',
      day: 'days ago',
      month: 'months ago',
    },
    root : '/',
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.copycode = Object.assign({"enable":true,"js":"/js/plugins/copycode.js","default_text":"Copy","success_text":"Copied"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
